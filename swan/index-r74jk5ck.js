class zJ{array;value;constructor(_,J){this.array=_,this.value=J}Disconnect(){let _=this.array.indexOf(this.value);if(_>-1)this.array.splice(_,1)}}class W_{connections;constructor(){this.connections=[]}Connect(_){return this.connections.push(_),new zJ(this.connections,_)}Emit(..._){for(let J of this.connections)try{J(..._)}catch(G){console.error(G)}}}function a0(_,J,G){return _+(J-_)*G}class i0{x;y;constructor(_=0,J=0){this.x=_,this.y=J}add(_){this.x+=_.x,this.y+=_.y}sub(_){this.x-=_.x,this.y-=_.y}mul(_){this.x*=_.x,this.y*=_.y}div(_){this.x/=_.x,this.y/=_.y}lerp(_,J){let G=a0(this.x,_.x,J),$=a0(this.y,_.y,J);this.x=G,this.y=$}serialize(){return[this.x,this.y]}}class D_{x;y;z;constructor(_=0,J=0,G=0){this.x=_,this.y=J,this.z=G}add(_){this.x+=_.x,this.y+=_.y,this.z+=_.z}sub(_){this.x-=_.x,this.y-=_.y,this.z-=_.z}mul(_){this.x*=_.x,this.y*=_.y,this.z*=_.z}div(_){this.x/=_.x,this.y/=_.y,this.z/=_.z}lerp(_,J){let G=a0(this.x,_.x,J),$=a0(this.y,_.y,J),T=a0(this.z,_.z,J);this.x=G,this.y=$,this.z=T}serialize(){return[this.x,this.y,this.z]}}class e0{rel_x;abs_x;rel_y;abs_y;constructor(_=0,J=0,G=0,$=0){this.rel_x=_,this.abs_x=J,this.rel_y=G,this.abs_y=$}lerp(_,J){let G=a0(this.rel_x,_.rel_x,J),$=a0(this.abs_x,_.abs_x,J),T=a0(this.rel_y,_.rel_y,J),L=a0(this.abs_y,_.abs_y,J);this.rel_x=G,this.abs_x=$,this.rel_y=T,this.abs_y=L}toAbs(_,J){return new i0(this.abs_x+Math.round(_*this.rel_x),this.abs_y+Math.round(J*this.rel_y))}serialize(_){let J=_.view.Camera.ViewportSize;return this.toAbs(J.x,J.y).serialize()}}var z_={fromAbs:(_,J)=>{return new e0(0,_,0,J)},fromRel:(_,J)=>{return new e0(_,0,J,0)}};var w_=`const pos = array(vec2f(-1, -1), vec2f(1, -1), vec2f(-1, 1), vec2f(1, 1));

const CURVATURE: f32 = 4.2;
const BLUR: f32 = 0.021;
const CA_AMT: f32 = 1.024;

struct RenderDescriptor {
  time: f32,
  delta_time: f32,

  view: mat4x4f,
  static_view: mat4x4f,

  scale: f32,
  viewport_size: vec2f,
}

@group(0) @binding(0) var u_texture: texture_2d<f32>;
@group(0) @binding(1) var u_sampler: sampler;

@group(0) @binding(2) var<uniform> desc: RenderDescriptor;

@vertex
fn vertex_main(@builtin(vertex_index) vertex: u32) -> @builtin(position) vec4f {
  return vec4f(pos[vertex], 0, 1);
}

// THE GOAT
// https://www.shadertoy.com/view/DlfSz8
// ^^^^^
@fragment
fn frag_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy / desc.viewport_size;

    // Curving
    var crtUV = uv * 2.0 - vec2<f32>(1.0, 1.0);
    let offset = crtUV.yx / CURVATURE;
    crtUV += crtUV * offset * offset;
    crtUV = crtUV * 0.5 + vec2<f32>(0.5, 0.5);

    // Edge fade
    let edge = smoothstep(vec2<f32>(0.0), vec2<f32>(BLUR), crtUV) *
               (vec2<f32>(1.0) - smoothstep(vec2<f32>(1.0 - BLUR), vec2<f32>(1.0), crtUV));

    // Chromatic aberration
    let r = textureSample(u_texture, u_sampler, (crtUV - vec2<f32>(0.5)) * CA_AMT + vec2<f32>(0.5)).r;
    let g = textureSample(u_texture, u_sampler, crtUV).g;
    let b = textureSample(u_texture, u_sampler, (crtUV - vec2<f32>(0.5)) / CA_AMT + vec2<f32>(0.5)).b;
    var color = vec3<f32>(r, g, b) * edge.x * edge.y;

    // Scanlines and grille
    if (fragCoord.y % 2.0 < 1.0) {
        color *= 0.7;
    } else if (fragCoord.x % 3.0 < 1.0) {
        color *= 0.7;
    } else {
        color *= 1.2;
    }

    return vec4<f32>(color, 1.0);
}

`;function yU(_,J){return class extends _{constructor(...G){super(...G);J(this)}}}var pU=yU(Array,(_)=>_.fill(0)),o=0.000001;function bU(_){function J(h=0,N=0){let k=new _(2);if(h!==void 0){if(k[0]=h,N!==void 0)k[1]=N}return k}let G=J;function $(h,N,k){let U=k??new _(2);return U[0]=h,U[1]=N,U}function T(h,N){let k=N??new _(2);return k[0]=Math.ceil(h[0]),k[1]=Math.ceil(h[1]),k}function L(h,N){let k=N??new _(2);return k[0]=Math.floor(h[0]),k[1]=Math.floor(h[1]),k}function I(h,N){let k=N??new _(2);return k[0]=Math.round(h[0]),k[1]=Math.round(h[1]),k}function z(h,N=0,k=1,U){let W=U??new _(2);return W[0]=Math.min(k,Math.max(N,h[0])),W[1]=Math.min(k,Math.max(N,h[1])),W}function l(h,N,k){let U=k??new _(2);return U[0]=h[0]+N[0],U[1]=h[1]+N[1],U}function x(h,N,k,U){let W=U??new _(2);return W[0]=h[0]+N[0]*k,W[1]=h[1]+N[1]*k,W}function b(h,N){let k=h[0],U=h[1],W=N[0],Q=N[1],Z=Math.sqrt(k*k+U*U),F=Math.sqrt(W*W+Q*Q),Y=Z*F,O=Y&&z0(h,N)/Y;return Math.acos(O)}function r(h,N,k){let U=k??new _(2);return U[0]=h[0]-N[0],U[1]=h[1]-N[1],U}let J0=r;function U0(h,N){return Math.abs(h[0]-N[0])<o&&Math.abs(h[1]-N[1])<o}function s(h,N){return h[0]===N[0]&&h[1]===N[1]}function X0(h,N,k,U){let W=U??new _(2);return W[0]=h[0]+k*(N[0]-h[0]),W[1]=h[1]+k*(N[1]-h[1]),W}function Z0(h,N,k,U){let W=U??new _(2);return W[0]=h[0]+k[0]*(N[0]-h[0]),W[1]=h[1]+k[1]*(N[1]-h[1]),W}function I0(h,N,k){let U=k??new _(2);return U[0]=Math.max(h[0],N[0]),U[1]=Math.max(h[1],N[1]),U}function _0(h,N,k){let U=k??new _(2);return U[0]=Math.min(h[0],N[0]),U[1]=Math.min(h[1],N[1]),U}function B0(h,N,k){let U=k??new _(2);return U[0]=h[0]*N,U[1]=h[1]*N,U}let c0=B0;function A0(h,N,k){let U=k??new _(2);return U[0]=h[0]/N,U[1]=h[1]/N,U}function f0(h,N){let k=N??new _(2);return k[0]=1/h[0],k[1]=1/h[1],k}let x0=f0;function g0(h,N,k){let U=k??new _(3),W=h[0]*N[1]-h[1]*N[0];return U[0]=0,U[1]=0,U[2]=W,U}function z0(h,N){return h[0]*N[0]+h[1]*N[1]}function Y0(h){let N=h[0],k=h[1];return Math.sqrt(N*N+k*k)}let b0=Y0;function h0(h){let N=h[0],k=h[1];return N*N+k*k}let v0=h0;function W0(h,N){let k=h[0]-N[0],U=h[1]-N[1];return Math.sqrt(k*k+U*U)}let w=W0;function m(h,N){let k=h[0]-N[0],U=h[1]-N[1];return k*k+U*U}let i=m;function N0(h,N){let k=N??new _(2),U=h[0],W=h[1],Q=Math.sqrt(U*U+W*W);if(Q>0.00001)k[0]=U/Q,k[1]=W/Q;else k[0]=0,k[1]=0;return k}function d0(h,N){let k=N??new _(2);return k[0]=-h[0],k[1]=-h[1],k}function e(h,N){let k=N??new _(2);return k[0]=h[0],k[1]=h[1],k}let o0=e;function q0(h,N,k){let U=k??new _(2);return U[0]=h[0]*N[0],U[1]=h[1]*N[1],U}let r0=q0;function S0(h,N,k){let U=k??new _(2);return U[0]=h[0]/N[0],U[1]=h[1]/N[1],U}let y0=S0;function p0(h=1,N){let k=N??new _(2),U=Math.random()*2*Math.PI;return k[0]=Math.cos(U)*h,k[1]=Math.sin(U)*h,k}function q(h){let N=h??new _(2);return N[0]=0,N[1]=0,N}function g(h,N,k){let U=k??new _(2),W=h[0],Q=h[1];return U[0]=W*N[0]+Q*N[4]+N[12],U[1]=W*N[1]+Q*N[5]+N[13],U}function j(h,N,k){let U=k??new _(2),W=h[0],Q=h[1];return U[0]=N[0]*W+N[4]*Q+N[8],U[1]=N[1]*W+N[5]*Q+N[9],U}function K(h,N,k,U){let W=U??new _(2),Q=h[0]-N[0],Z=h[1]-N[1],F=Math.sin(k),Y=Math.cos(k);return W[0]=Q*Y-Z*F+N[0],W[1]=Q*F+Z*Y+N[1],W}function B(h,N,k){let U=k??new _(2);return N0(h,U),B0(U,N,U)}function X(h,N,k){let U=k??new _(2);if(Y0(h)>N)return B(h,N,U);return e(h,U)}function V(h,N,k){let U=k??new _(2);return X0(h,N,0.5,U)}return{create:J,fromValues:G,set:$,ceil:T,floor:L,round:I,clamp:z,add:l,addScaled:x,angle:b,subtract:r,sub:J0,equalsApproximately:U0,equals:s,lerp:X0,lerpV:Z0,max:I0,min:_0,mulScalar:B0,scale:c0,divScalar:A0,inverse:f0,invert:x0,cross:g0,dot:z0,length:Y0,len:b0,lengthSq:h0,lenSq:v0,distance:W0,dist:w,distanceSq:m,distSq:i,normalize:N0,negate:d0,copy:e,clone:o0,multiply:q0,mul:r0,divide:S0,div:y0,random:p0,zero:q,transformMat4:g,transformMat3:j,rotate:K,setLength:B,truncate:X,midpoint:V}}var lJ=new Map;function pJ(_){let J=lJ.get(_);if(!J)J=bU(_),lJ.set(_,J);return J}function vU(_){function J(F,Y,O){let H=new _(3);if(F!==void 0){if(H[0]=F,Y!==void 0){if(H[1]=Y,O!==void 0)H[2]=O}}return H}let G=J;function $(F,Y,O,H){let S=H??new _(3);return S[0]=F,S[1]=Y,S[2]=O,S}function T(F,Y){let O=Y??new _(3);return O[0]=Math.ceil(F[0]),O[1]=Math.ceil(F[1]),O[2]=Math.ceil(F[2]),O}function L(F,Y){let O=Y??new _(3);return O[0]=Math.floor(F[0]),O[1]=Math.floor(F[1]),O[2]=Math.floor(F[2]),O}function I(F,Y){let O=Y??new _(3);return O[0]=Math.round(F[0]),O[1]=Math.round(F[1]),O[2]=Math.round(F[2]),O}function z(F,Y=0,O=1,H){let S=H??new _(3);return S[0]=Math.min(O,Math.max(Y,F[0])),S[1]=Math.min(O,Math.max(Y,F[1])),S[2]=Math.min(O,Math.max(Y,F[2])),S}function l(F,Y,O){let H=O??new _(3);return H[0]=F[0]+Y[0],H[1]=F[1]+Y[1],H[2]=F[2]+Y[2],H}function x(F,Y,O,H){let S=H??new _(3);return S[0]=F[0]+Y[0]*O,S[1]=F[1]+Y[1]*O,S[2]=F[2]+Y[2]*O,S}function b(F,Y){let O=F[0],H=F[1],S=F[2],A=Y[0],f=Y[1],c=Y[2],C=Math.sqrt(O*O+H*H+S*S),u=Math.sqrt(A*A+f*f+c*c),y=C*u,d=y&&z0(F,Y)/y;return Math.acos(d)}function r(F,Y,O){let H=O??new _(3);return H[0]=F[0]-Y[0],H[1]=F[1]-Y[1],H[2]=F[2]-Y[2],H}let J0=r;function U0(F,Y){return Math.abs(F[0]-Y[0])<o&&Math.abs(F[1]-Y[1])<o&&Math.abs(F[2]-Y[2])<o}function s(F,Y){return F[0]===Y[0]&&F[1]===Y[1]&&F[2]===Y[2]}function X0(F,Y,O,H){let S=H??new _(3);return S[0]=F[0]+O*(Y[0]-F[0]),S[1]=F[1]+O*(Y[1]-F[1]),S[2]=F[2]+O*(Y[2]-F[2]),S}function Z0(F,Y,O,H){let S=H??new _(3);return S[0]=F[0]+O[0]*(Y[0]-F[0]),S[1]=F[1]+O[1]*(Y[1]-F[1]),S[2]=F[2]+O[2]*(Y[2]-F[2]),S}function I0(F,Y,O){let H=O??new _(3);return H[0]=Math.max(F[0],Y[0]),H[1]=Math.max(F[1],Y[1]),H[2]=Math.max(F[2],Y[2]),H}function _0(F,Y,O){let H=O??new _(3);return H[0]=Math.min(F[0],Y[0]),H[1]=Math.min(F[1],Y[1]),H[2]=Math.min(F[2],Y[2]),H}function B0(F,Y,O){let H=O??new _(3);return H[0]=F[0]*Y,H[1]=F[1]*Y,H[2]=F[2]*Y,H}let c0=B0;function A0(F,Y,O){let H=O??new _(3);return H[0]=F[0]/Y,H[1]=F[1]/Y,H[2]=F[2]/Y,H}function f0(F,Y){let O=Y??new _(3);return O[0]=1/F[0],O[1]=1/F[1],O[2]=1/F[2],O}let x0=f0;function g0(F,Y,O){let H=O??new _(3),S=F[2]*Y[0]-F[0]*Y[2],A=F[0]*Y[1]-F[1]*Y[0];return H[0]=F[1]*Y[2]-F[2]*Y[1],H[1]=S,H[2]=A,H}function z0(F,Y){return F[0]*Y[0]+F[1]*Y[1]+F[2]*Y[2]}function Y0(F){let Y=F[0],O=F[1],H=F[2];return Math.sqrt(Y*Y+O*O+H*H)}let b0=Y0;function h0(F){let Y=F[0],O=F[1],H=F[2];return Y*Y+O*O+H*H}let v0=h0;function W0(F,Y){let O=F[0]-Y[0],H=F[1]-Y[1],S=F[2]-Y[2];return Math.sqrt(O*O+H*H+S*S)}let w=W0;function m(F,Y){let O=F[0]-Y[0],H=F[1]-Y[1],S=F[2]-Y[2];return O*O+H*H+S*S}let i=m;function N0(F,Y){let O=Y??new _(3),H=F[0],S=F[1],A=F[2],f=Math.sqrt(H*H+S*S+A*A);if(f>0.00001)O[0]=H/f,O[1]=S/f,O[2]=A/f;else O[0]=0,O[1]=0,O[2]=0;return O}function d0(F,Y){let O=Y??new _(3);return O[0]=-F[0],O[1]=-F[1],O[2]=-F[2],O}function e(F,Y){let O=Y??new _(3);return O[0]=F[0],O[1]=F[1],O[2]=F[2],O}let o0=e;function q0(F,Y,O){let H=O??new _(3);return H[0]=F[0]*Y[0],H[1]=F[1]*Y[1],H[2]=F[2]*Y[2],H}let r0=q0;function S0(F,Y,O){let H=O??new _(3);return H[0]=F[0]/Y[0],H[1]=F[1]/Y[1],H[2]=F[2]/Y[2],H}let y0=S0;function p0(F=1,Y){let O=Y??new _(3),H=Math.random()*2*Math.PI,S=Math.random()*2-1,A=Math.sqrt(1-S*S)*F;return O[0]=Math.cos(H)*A,O[1]=Math.sin(H)*A,O[2]=S*F,O}function q(F){let Y=F??new _(3);return Y[0]=0,Y[1]=0,Y[2]=0,Y}function g(F,Y,O){let H=O??new _(3),S=F[0],A=F[1],f=F[2],c=Y[3]*S+Y[7]*A+Y[11]*f+Y[15]||1;return H[0]=(Y[0]*S+Y[4]*A+Y[8]*f+Y[12])/c,H[1]=(Y[1]*S+Y[5]*A+Y[9]*f+Y[13])/c,H[2]=(Y[2]*S+Y[6]*A+Y[10]*f+Y[14])/c,H}function j(F,Y,O){let H=O??new _(3),S=F[0],A=F[1],f=F[2];return H[0]=S*Y[0]+A*Y[4]+f*Y[8],H[1]=S*Y[1]+A*Y[5]+f*Y[9],H[2]=S*Y[2]+A*Y[6]+f*Y[10],H}function K(F,Y,O){let H=O??new _(3),S=F[0],A=F[1],f=F[2];return H[0]=S*Y[0]+A*Y[4]+f*Y[8],H[1]=S*Y[1]+A*Y[5]+f*Y[9],H[2]=S*Y[2]+A*Y[6]+f*Y[10],H}function B(F,Y,O){let H=O??new _(3),S=Y[0],A=Y[1],f=Y[2],c=Y[3]*2,C=F[0],u=F[1],y=F[2],d=A*y-f*u,p=f*C-S*y,v=S*u-A*C;return H[0]=C+d*c+(A*v-f*p)*2,H[1]=u+p*c+(f*d-S*v)*2,H[2]=y+v*c+(S*p-A*d)*2,H}function X(F,Y){let O=Y??new _(3);return O[0]=F[12],O[1]=F[13],O[2]=F[14],O}function V(F,Y,O){let H=O??new _(3),S=Y*4;return H[0]=F[S+0],H[1]=F[S+1],H[2]=F[S+2],H}function h(F,Y){let O=Y??new _(3),H=F[0],S=F[1],A=F[2],f=F[4],c=F[5],C=F[6],u=F[8],y=F[9],d=F[10];return O[0]=Math.sqrt(H*H+S*S+A*A),O[1]=Math.sqrt(f*f+c*c+C*C),O[2]=Math.sqrt(u*u+y*y+d*d),O}function N(F,Y,O,H){let S=H??new _(3),A=[],f=[];return A[0]=F[0]-Y[0],A[1]=F[1]-Y[1],A[2]=F[2]-Y[2],f[0]=A[0],f[1]=A[1]*Math.cos(O)-A[2]*Math.sin(O),f[2]=A[1]*Math.sin(O)+A[2]*Math.cos(O),S[0]=f[0]+Y[0],S[1]=f[1]+Y[1],S[2]=f[2]+Y[2],S}function k(F,Y,O,H){let S=H??new _(3),A=[],f=[];return A[0]=F[0]-Y[0],A[1]=F[1]-Y[1],A[2]=F[2]-Y[2],f[0]=A[2]*Math.sin(O)+A[0]*Math.cos(O),f[1]=A[1],f[2]=A[2]*Math.cos(O)-A[0]*Math.sin(O),S[0]=f[0]+Y[0],S[1]=f[1]+Y[1],S[2]=f[2]+Y[2],S}function U(F,Y,O,H){let S=H??new _(3),A=[],f=[];return A[0]=F[0]-Y[0],A[1]=F[1]-Y[1],A[2]=F[2]-Y[2],f[0]=A[0]*Math.cos(O)-A[1]*Math.sin(O),f[1]=A[0]*Math.sin(O)+A[1]*Math.cos(O),f[2]=A[2],S[0]=f[0]+Y[0],S[1]=f[1]+Y[1],S[2]=f[2]+Y[2],S}function W(F,Y,O){let H=O??new _(3);return N0(F,H),B0(H,Y,H)}function Q(F,Y,O){let H=O??new _(3);if(Y0(F)>Y)return W(F,Y,H);return e(F,H)}function Z(F,Y,O){let H=O??new _(3);return X0(F,Y,0.5,H)}return{create:J,fromValues:G,set:$,ceil:T,floor:L,round:I,clamp:z,add:l,addScaled:x,angle:b,subtract:r,sub:J0,equalsApproximately:U0,equals:s,lerp:X0,lerpV:Z0,max:I0,min:_0,mulScalar:B0,scale:c0,divScalar:A0,inverse:f0,invert:x0,cross:g0,dot:z0,length:Y0,len:b0,lengthSq:h0,lenSq:v0,distance:W0,dist:w,distanceSq:m,distSq:i,normalize:N0,negate:d0,copy:e,clone:o0,multiply:q0,mul:r0,divide:S0,div:y0,random:p0,zero:q,transformMat4:g,transformMat4Upper3x3:j,transformMat3:K,transformQuat:B,getTranslation:X,getAxis:V,getScaling:h,rotateX:N,rotateY:k,rotateZ:U,setLength:W,truncate:Q,midpoint:Z}}var CJ=new Map;function l_(_){let J=CJ.get(_);if(!J)J=vU(_),CJ.set(_,J);return J}function dU(_){let J=pJ(_),G=l_(_);function $(K,B,X,V,h,N,k,U,W){let Q=new _(12);if(Q[3]=0,Q[7]=0,Q[11]=0,K!==void 0){if(Q[0]=K,B!==void 0){if(Q[1]=B,X!==void 0){if(Q[2]=X,V!==void 0){if(Q[4]=V,h!==void 0){if(Q[5]=h,N!==void 0){if(Q[6]=N,k!==void 0){if(Q[8]=k,U!==void 0){if(Q[9]=U,W!==void 0)Q[10]=W}}}}}}}}return Q}function T(K,B,X,V,h,N,k,U,W,Q){let Z=Q??new _(12);return Z[0]=K,Z[1]=B,Z[2]=X,Z[3]=0,Z[4]=V,Z[5]=h,Z[6]=N,Z[7]=0,Z[8]=k,Z[9]=U,Z[10]=W,Z[11]=0,Z}function L(K,B){let X=B??new _(12);return X[0]=K[0],X[1]=K[1],X[2]=K[2],X[3]=0,X[4]=K[4],X[5]=K[5],X[6]=K[6],X[7]=0,X[8]=K[8],X[9]=K[9],X[10]=K[10],X[11]=0,X}function I(K,B){let X=B??new _(12),V=K[0],h=K[1],N=K[2],k=K[3],U=V+V,W=h+h,Q=N+N,Z=V*U,F=h*U,Y=h*W,O=N*U,H=N*W,S=N*Q,A=k*U,f=k*W,c=k*Q;return X[0]=1-Y-S,X[1]=F+c,X[2]=O-f,X[3]=0,X[4]=F-c,X[5]=1-Z-S,X[6]=H+A,X[7]=0,X[8]=O+f,X[9]=H-A,X[10]=1-Z-Y,X[11]=0,X}function z(K,B){let X=B??new _(12);return X[0]=-K[0],X[1]=-K[1],X[2]=-K[2],X[4]=-K[4],X[5]=-K[5],X[6]=-K[6],X[8]=-K[8],X[9]=-K[9],X[10]=-K[10],X}function l(K,B,X){let V=X??new _(12);return V[0]=K[0]*B,V[1]=K[1]*B,V[2]=K[2]*B,V[4]=K[4]*B,V[5]=K[5]*B,V[6]=K[6]*B,V[8]=K[8]*B,V[9]=K[9]*B,V[10]=K[10]*B,V}let x=l;function b(K,B,X){let V=X??new _(12);return V[0]=K[0]+B[0],V[1]=K[1]+B[1],V[2]=K[2]+B[2],V[4]=K[4]+B[4],V[5]=K[5]+B[5],V[6]=K[6]+B[6],V[8]=K[8]+B[8],V[9]=K[9]+B[9],V[10]=K[10]+B[10],V}function r(K,B){let X=B??new _(12);return X[0]=K[0],X[1]=K[1],X[2]=K[2],X[4]=K[4],X[5]=K[5],X[6]=K[6],X[8]=K[8],X[9]=K[9],X[10]=K[10],X}let J0=r;function U0(K,B){return Math.abs(K[0]-B[0])<o&&Math.abs(K[1]-B[1])<o&&Math.abs(K[2]-B[2])<o&&Math.abs(K[4]-B[4])<o&&Math.abs(K[5]-B[5])<o&&Math.abs(K[6]-B[6])<o&&Math.abs(K[8]-B[8])<o&&Math.abs(K[9]-B[9])<o&&Math.abs(K[10]-B[10])<o}function s(K,B){return K[0]===B[0]&&K[1]===B[1]&&K[2]===B[2]&&K[4]===B[4]&&K[5]===B[5]&&K[6]===B[6]&&K[8]===B[8]&&K[9]===B[9]&&K[10]===B[10]}function X0(K){let B=K??new _(12);return B[0]=1,B[1]=0,B[2]=0,B[4]=0,B[5]=1,B[6]=0,B[8]=0,B[9]=0,B[10]=1,B}function Z0(K,B){let X=B??new _(12);if(X===K){let Y;return Y=K[1],K[1]=K[4],K[4]=Y,Y=K[2],K[2]=K[8],K[8]=Y,Y=K[6],K[6]=K[9],K[9]=Y,X}let V=K[0],h=K[1],N=K[2],k=K[4],U=K[5],W=K[6],Q=K[8],Z=K[9],F=K[10];return X[0]=V,X[1]=k,X[2]=Q,X[4]=h,X[5]=U,X[6]=Z,X[8]=N,X[9]=W,X[10]=F,X}function I0(K,B){let X=B??new _(12),V=K[0],h=K[1],N=K[2],k=K[4],U=K[5],W=K[6],Q=K[8],Z=K[9],F=K[10],Y=F*U-W*Z,O=-F*k+W*Q,H=Z*k-U*Q,S=1/(V*Y+h*O+N*H);return X[0]=Y*S,X[1]=(-F*h+N*Z)*S,X[2]=(W*h-N*U)*S,X[4]=O*S,X[5]=(F*V-N*Q)*S,X[6]=(-W*V+N*k)*S,X[8]=H*S,X[9]=(-Z*V+h*Q)*S,X[10]=(U*V-h*k)*S,X}function _0(K){let B=K[0],X=K[1],V=K[2],h=K[4],N=K[5],k=K[6],U=K[8],W=K[9],Q=K[10];return B*(N*Q-W*k)-h*(X*Q-W*V)+U*(X*k-N*V)}let B0=I0;function c0(K,B,X){let V=X??new _(12),h=K[0],N=K[1],k=K[2],U=K[4],W=K[5],Q=K[6],Z=K[8],F=K[9],Y=K[10],O=B[0],H=B[1],S=B[2],A=B[4],f=B[5],c=B[6],C=B[8],u=B[9],y=B[10];return V[0]=h*O+U*H+Z*S,V[1]=N*O+W*H+F*S,V[2]=k*O+Q*H+Y*S,V[4]=h*A+U*f+Z*c,V[5]=N*A+W*f+F*c,V[6]=k*A+Q*f+Y*c,V[8]=h*C+U*u+Z*y,V[9]=N*C+W*u+F*y,V[10]=k*C+Q*u+Y*y,V}let A0=c0;function f0(K,B,X){let V=X??X0();if(K!==V)V[0]=K[0],V[1]=K[1],V[2]=K[2],V[4]=K[4],V[5]=K[5],V[6]=K[6];return V[8]=B[0],V[9]=B[1],V[10]=1,V}function x0(K,B){let X=B??J.create();return X[0]=K[8],X[1]=K[9],X}function g0(K,B,X){let V=X??J.create(),h=B*4;return V[0]=K[h+0],V[1]=K[h+1],V}function z0(K,B,X,V){let h=V===K?K:r(K,V),N=X*4;return h[N+0]=B[0],h[N+1]=B[1],h}function Y0(K,B){let X=B??J.create(),V=K[0],h=K[1],N=K[4],k=K[5];return X[0]=Math.sqrt(V*V+h*h),X[1]=Math.sqrt(N*N+k*k),X}function b0(K,B){let X=B??G.create(),V=K[0],h=K[1],N=K[2],k=K[4],U=K[5],W=K[6],Q=K[8],Z=K[9],F=K[10];return X[0]=Math.sqrt(V*V+h*h+N*N),X[1]=Math.sqrt(k*k+U*U+W*W),X[2]=Math.sqrt(Q*Q+Z*Z+F*F),X}function h0(K,B){let X=B??new _(12);return X[0]=1,X[1]=0,X[2]=0,X[4]=0,X[5]=1,X[6]=0,X[8]=K[0],X[9]=K[1],X[10]=1,X}function v0(K,B,X){let V=X??new _(12),h=B[0],N=B[1],k=K[0],U=K[1],W=K[2],Q=K[4],Z=K[5],F=K[6],Y=K[8],O=K[9],H=K[10];if(K!==V)V[0]=k,V[1]=U,V[2]=W,V[4]=Q,V[5]=Z,V[6]=F;return V[8]=k*h+Q*N+Y,V[9]=U*h+Z*N+O,V[10]=W*h+F*N+H,V}function W0(K,B){let X=B??new _(12),V=Math.cos(K),h=Math.sin(K);return X[0]=V,X[1]=h,X[2]=0,X[4]=-h,X[5]=V,X[6]=0,X[8]=0,X[9]=0,X[10]=1,X}function w(K,B,X){let V=X??new _(12),h=K[0],N=K[1],k=K[2],U=K[4],W=K[5],Q=K[6],Z=Math.cos(B),F=Math.sin(B);if(V[0]=Z*h+F*U,V[1]=Z*N+F*W,V[2]=Z*k+F*Q,V[4]=Z*U-F*h,V[5]=Z*W-F*N,V[6]=Z*Q-F*k,K!==V)V[8]=K[8],V[9]=K[9],V[10]=K[10];return V}function m(K,B){let X=B??new _(12),V=Math.cos(K),h=Math.sin(K);return X[0]=1,X[1]=0,X[2]=0,X[4]=0,X[5]=V,X[6]=h,X[8]=0,X[9]=-h,X[10]=V,X}function i(K,B,X){let V=X??new _(12),h=K[4],N=K[5],k=K[6],U=K[8],W=K[9],Q=K[10],Z=Math.cos(B),F=Math.sin(B);if(V[4]=Z*h+F*U,V[5]=Z*N+F*W,V[6]=Z*k+F*Q,V[8]=Z*U-F*h,V[9]=Z*W-F*N,V[10]=Z*Q-F*k,K!==V)V[0]=K[0],V[1]=K[1],V[2]=K[2];return V}function N0(K,B){let X=B??new _(12),V=Math.cos(K),h=Math.sin(K);return X[0]=V,X[1]=0,X[2]=-h,X[4]=0,X[5]=1,X[6]=0,X[8]=h,X[9]=0,X[10]=V,X}function d0(K,B,X){let V=X??new _(12),h=K[0],N=K[1],k=K[2],U=K[8],W=K[9],Q=K[10],Z=Math.cos(B),F=Math.sin(B);if(V[0]=Z*h-F*U,V[1]=Z*N-F*W,V[2]=Z*k-F*Q,V[8]=Z*U+F*h,V[9]=Z*W+F*N,V[10]=Z*Q+F*k,K!==V)V[4]=K[4],V[5]=K[5],V[6]=K[6];return V}let e=W0,o0=w;function q0(K,B){let X=B??new _(12);return X[0]=K[0],X[1]=0,X[2]=0,X[4]=0,X[5]=K[1],X[6]=0,X[8]=0,X[9]=0,X[10]=1,X}function r0(K,B,X){let V=X??new _(12),h=B[0],N=B[1];if(V[0]=h*K[0],V[1]=h*K[1],V[2]=h*K[2],V[4]=N*K[4],V[5]=N*K[5],V[6]=N*K[6],K!==V)V[8]=K[8],V[9]=K[9],V[10]=K[10];return V}function S0(K,B){let X=B??new _(12);return X[0]=K[0],X[1]=0,X[2]=0,X[4]=0,X[5]=K[1],X[6]=0,X[8]=0,X[9]=0,X[10]=K[2],X}function y0(K,B,X){let V=X??new _(12),h=B[0],N=B[1],k=B[2];return V[0]=h*K[0],V[1]=h*K[1],V[2]=h*K[2],V[4]=N*K[4],V[5]=N*K[5],V[6]=N*K[6],V[8]=k*K[8],V[9]=k*K[9],V[10]=k*K[10],V}function p0(K,B){let X=B??new _(12);return X[0]=K,X[1]=0,X[2]=0,X[4]=0,X[5]=K,X[6]=0,X[8]=0,X[9]=0,X[10]=1,X}function q(K,B,X){let V=X??new _(12);if(V[0]=B*K[0],V[1]=B*K[1],V[2]=B*K[2],V[4]=B*K[4],V[5]=B*K[5],V[6]=B*K[6],K!==V)V[8]=K[8],V[9]=K[9],V[10]=K[10];return V}function g(K,B){let X=B??new _(12);return X[0]=K,X[1]=0,X[2]=0,X[4]=0,X[5]=K,X[6]=0,X[8]=0,X[9]=0,X[10]=K,X}function j(K,B,X){let V=X??new _(12);return V[0]=B*K[0],V[1]=B*K[1],V[2]=B*K[2],V[4]=B*K[4],V[5]=B*K[5],V[6]=B*K[6],V[8]=B*K[8],V[9]=B*K[9],V[10]=B*K[10],V}return{add:b,clone:J0,copy:r,create:$,determinant:_0,equals:s,equalsApproximately:U0,fromMat4:L,fromQuat:I,get3DScaling:b0,getAxis:g0,getScaling:Y0,getTranslation:x0,identity:X0,inverse:I0,invert:B0,mul:A0,mulScalar:x,multiply:c0,multiplyScalar:l,negate:z,rotate:w,rotateX:i,rotateY:d0,rotateZ:o0,rotation:W0,rotationX:m,rotationY:N0,rotationZ:e,scale:r0,scale3D:y0,scaling:q0,scaling3D:S0,set:T,setAxis:z0,setTranslation:f0,translate:v0,translation:h0,transpose:Z0,uniformScale:q,uniformScale3D:j,uniformScaling:p0,uniformScaling3D:g}}var uJ=new Map;function oU(_){let J=uJ.get(_);if(!J)J=dU(_),uJ.set(_,J);return J}function rU(_){let J=l_(_);function G(U,W,Q,Z,F,Y,O,H,S,A,f,c,C,u,y,d){let p=new _(16);if(U!==void 0){if(p[0]=U,W!==void 0){if(p[1]=W,Q!==void 0){if(p[2]=Q,Z!==void 0){if(p[3]=Z,F!==void 0){if(p[4]=F,Y!==void 0){if(p[5]=Y,O!==void 0){if(p[6]=O,H!==void 0){if(p[7]=H,S!==void 0){if(p[8]=S,A!==void 0){if(p[9]=A,f!==void 0){if(p[10]=f,c!==void 0){if(p[11]=c,C!==void 0){if(p[12]=C,u!==void 0){if(p[13]=u,y!==void 0){if(p[14]=y,d!==void 0)p[15]=d}}}}}}}}}}}}}}}return p}function $(U,W,Q,Z,F,Y,O,H,S,A,f,c,C,u,y,d,p){let v=p??new _(16);return v[0]=U,v[1]=W,v[2]=Q,v[3]=Z,v[4]=F,v[5]=Y,v[6]=O,v[7]=H,v[8]=S,v[9]=A,v[10]=f,v[11]=c,v[12]=C,v[13]=u,v[14]=y,v[15]=d,v}function T(U,W){let Q=W??new _(16);return Q[0]=U[0],Q[1]=U[1],Q[2]=U[2],Q[3]=0,Q[4]=U[4],Q[5]=U[5],Q[6]=U[6],Q[7]=0,Q[8]=U[8],Q[9]=U[9],Q[10]=U[10],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function L(U,W){let Q=W??new _(16),Z=U[0],F=U[1],Y=U[2],O=U[3],H=Z+Z,S=F+F,A=Y+Y,f=Z*H,c=F*H,C=F*S,u=Y*H,y=Y*S,d=Y*A,p=O*H,v=O*S,n=O*A;return Q[0]=1-C-d,Q[1]=c+n,Q[2]=u-v,Q[3]=0,Q[4]=c-n,Q[5]=1-f-d,Q[6]=y+p,Q[7]=0,Q[8]=u+v,Q[9]=y-p,Q[10]=1-f-C,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function I(U,W){let Q=W??new _(16);return Q[0]=-U[0],Q[1]=-U[1],Q[2]=-U[2],Q[3]=-U[3],Q[4]=-U[4],Q[5]=-U[5],Q[6]=-U[6],Q[7]=-U[7],Q[8]=-U[8],Q[9]=-U[9],Q[10]=-U[10],Q[11]=-U[11],Q[12]=-U[12],Q[13]=-U[13],Q[14]=-U[14],Q[15]=-U[15],Q}function z(U,W,Q){let Z=Q??new _(16);return Z[0]=U[0]+W[0],Z[1]=U[1]+W[1],Z[2]=U[2]+W[2],Z[3]=U[3]+W[3],Z[4]=U[4]+W[4],Z[5]=U[5]+W[5],Z[6]=U[6]+W[6],Z[7]=U[7]+W[7],Z[8]=U[8]+W[8],Z[9]=U[9]+W[9],Z[10]=U[10]+W[10],Z[11]=U[11]+W[11],Z[12]=U[12]+W[12],Z[13]=U[13]+W[13],Z[14]=U[14]+W[14],Z[15]=U[15]+W[15],Z}function l(U,W,Q){let Z=Q??new _(16);return Z[0]=U[0]*W,Z[1]=U[1]*W,Z[2]=U[2]*W,Z[3]=U[3]*W,Z[4]=U[4]*W,Z[5]=U[5]*W,Z[6]=U[6]*W,Z[7]=U[7]*W,Z[8]=U[8]*W,Z[9]=U[9]*W,Z[10]=U[10]*W,Z[11]=U[11]*W,Z[12]=U[12]*W,Z[13]=U[13]*W,Z[14]=U[14]*W,Z[15]=U[15]*W,Z}let x=l;function b(U,W){let Q=W??new _(16);return Q[0]=U[0],Q[1]=U[1],Q[2]=U[2],Q[3]=U[3],Q[4]=U[4],Q[5]=U[5],Q[6]=U[6],Q[7]=U[7],Q[8]=U[8],Q[9]=U[9],Q[10]=U[10],Q[11]=U[11],Q[12]=U[12],Q[13]=U[13],Q[14]=U[14],Q[15]=U[15],Q}let r=b;function J0(U,W){return Math.abs(U[0]-W[0])<o&&Math.abs(U[1]-W[1])<o&&Math.abs(U[2]-W[2])<o&&Math.abs(U[3]-W[3])<o&&Math.abs(U[4]-W[4])<o&&Math.abs(U[5]-W[5])<o&&Math.abs(U[6]-W[6])<o&&Math.abs(U[7]-W[7])<o&&Math.abs(U[8]-W[8])<o&&Math.abs(U[9]-W[9])<o&&Math.abs(U[10]-W[10])<o&&Math.abs(U[11]-W[11])<o&&Math.abs(U[12]-W[12])<o&&Math.abs(U[13]-W[13])<o&&Math.abs(U[14]-W[14])<o&&Math.abs(U[15]-W[15])<o}function U0(U,W){return U[0]===W[0]&&U[1]===W[1]&&U[2]===W[2]&&U[3]===W[3]&&U[4]===W[4]&&U[5]===W[5]&&U[6]===W[6]&&U[7]===W[7]&&U[8]===W[8]&&U[9]===W[9]&&U[10]===W[10]&&U[11]===W[11]&&U[12]===W[12]&&U[13]===W[13]&&U[14]===W[14]&&U[15]===W[15]}function s(U){let W=U??new _(16);return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W}function X0(U,W){let Q=W??new _(16);if(Q===U){let a;return a=U[1],U[1]=U[4],U[4]=a,a=U[2],U[2]=U[8],U[8]=a,a=U[3],U[3]=U[12],U[12]=a,a=U[6],U[6]=U[9],U[9]=a,a=U[7],U[7]=U[13],U[13]=a,a=U[11],U[11]=U[14],U[14]=a,Q}let Z=U[0],F=U[1],Y=U[2],O=U[3],H=U[4],S=U[5],A=U[6],f=U[7],c=U[8],C=U[9],u=U[10],y=U[11],d=U[12],p=U[13],v=U[14],n=U[15];return Q[0]=Z,Q[1]=H,Q[2]=c,Q[3]=d,Q[4]=F,Q[5]=S,Q[6]=C,Q[7]=p,Q[8]=Y,Q[9]=A,Q[10]=u,Q[11]=v,Q[12]=O,Q[13]=f,Q[14]=y,Q[15]=n,Q}function Z0(U,W){let Q=W??new _(16),Z=U[0],F=U[1],Y=U[2],O=U[3],H=U[4],S=U[5],A=U[6],f=U[7],c=U[8],C=U[9],u=U[10],y=U[11],d=U[12],p=U[13],v=U[14],n=U[15],a=u*n,K0=v*y,F0=A*n,G0=v*f,$0=A*y,M0=u*f,V0=Y*n,H0=v*O,j0=Y*y,T0=u*O,L0=Y*f,k0=A*O,E0=c*p,P0=d*C,l0=H*p,C0=d*S,u0=H*C,R_=c*S,q_=Z*p,S_=d*F,I_=Z*C,A_=c*F,f_=Z*S,g_=H*F,IJ=a*S+G0*C+$0*p-(K0*S+F0*C+M0*p),AJ=K0*F+V0*C+T0*p-(a*F+H0*C+j0*p),fJ=F0*F+H0*S+L0*p-(G0*F+V0*S+k0*p),gJ=M0*F+j0*S+k0*C-($0*F+T0*S+L0*C),O0=1/(Z*IJ+H*AJ+c*fJ+d*gJ);return Q[0]=O0*IJ,Q[1]=O0*AJ,Q[2]=O0*fJ,Q[3]=O0*gJ,Q[4]=O0*(K0*H+F0*c+M0*d-(a*H+G0*c+$0*d)),Q[5]=O0*(a*Z+H0*c+j0*d-(K0*Z+V0*c+T0*d)),Q[6]=O0*(G0*Z+V0*H+k0*d-(F0*Z+H0*H+L0*d)),Q[7]=O0*($0*Z+T0*H+L0*c-(M0*Z+j0*H+k0*c)),Q[8]=O0*(E0*f+C0*y+u0*n-(P0*f+l0*y+R_*n)),Q[9]=O0*(P0*O+q_*y+A_*n-(E0*O+S_*y+I_*n)),Q[10]=O0*(l0*O+S_*f+f_*n-(C0*O+q_*f+g_*n)),Q[11]=O0*(R_*O+I_*f+g_*y-(u0*O+A_*f+f_*y)),Q[12]=O0*(l0*u+R_*v+P0*A-(u0*v+E0*A+C0*u)),Q[13]=O0*(I_*v+E0*Y+S_*u-(q_*u+A_*v+P0*Y)),Q[14]=O0*(q_*A+g_*v+C0*Y-(f_*v+l0*Y+S_*A)),Q[15]=O0*(f_*u+u0*Y+A_*A-(I_*A+g_*u+R_*Y)),Q}function I0(U){let W=U[0],Q=U[1],Z=U[2],F=U[3],Y=U[4],O=U[5],H=U[6],S=U[7],A=U[8],f=U[9],c=U[10],C=U[11],u=U[12],y=U[13],d=U[14],p=U[15],v=c*p,n=d*C,a=H*p,K0=d*S,F0=H*C,G0=c*S,$0=Z*p,M0=d*F,V0=Z*C,H0=c*F,j0=Z*S,T0=H*F,L0=v*O+K0*f+F0*y-(n*O+a*f+G0*y),k0=n*Q+$0*f+H0*y-(v*Q+M0*f+V0*y),E0=a*Q+M0*O+j0*y-(K0*Q+$0*O+T0*y),P0=G0*Q+V0*O+T0*f-(F0*Q+H0*O+j0*f);return W*L0+Y*k0+A*E0+u*P0}let _0=Z0;function B0(U,W,Q){let Z=Q??new _(16),F=U[0],Y=U[1],O=U[2],H=U[3],S=U[4],A=U[5],f=U[6],c=U[7],C=U[8],u=U[9],y=U[10],d=U[11],p=U[12],v=U[13],n=U[14],a=U[15],K0=W[0],F0=W[1],G0=W[2],$0=W[3],M0=W[4],V0=W[5],H0=W[6],j0=W[7],T0=W[8],L0=W[9],k0=W[10],E0=W[11],P0=W[12],l0=W[13],C0=W[14],u0=W[15];return Z[0]=F*K0+S*F0+C*G0+p*$0,Z[1]=Y*K0+A*F0+u*G0+v*$0,Z[2]=O*K0+f*F0+y*G0+n*$0,Z[3]=H*K0+c*F0+d*G0+a*$0,Z[4]=F*M0+S*V0+C*H0+p*j0,Z[5]=Y*M0+A*V0+u*H0+v*j0,Z[6]=O*M0+f*V0+y*H0+n*j0,Z[7]=H*M0+c*V0+d*H0+a*j0,Z[8]=F*T0+S*L0+C*k0+p*E0,Z[9]=Y*T0+A*L0+u*k0+v*E0,Z[10]=O*T0+f*L0+y*k0+n*E0,Z[11]=H*T0+c*L0+d*k0+a*E0,Z[12]=F*P0+S*l0+C*C0+p*u0,Z[13]=Y*P0+A*l0+u*C0+v*u0,Z[14]=O*P0+f*l0+y*C0+n*u0,Z[15]=H*P0+c*l0+d*C0+a*u0,Z}let c0=B0;function A0(U,W,Q){let Z=Q??s();if(U!==Z)Z[0]=U[0],Z[1]=U[1],Z[2]=U[2],Z[3]=U[3],Z[4]=U[4],Z[5]=U[5],Z[6]=U[6],Z[7]=U[7],Z[8]=U[8],Z[9]=U[9],Z[10]=U[10],Z[11]=U[11];return Z[12]=W[0],Z[13]=W[1],Z[14]=W[2],Z[15]=1,Z}function f0(U,W){let Q=W??J.create();return Q[0]=U[12],Q[1]=U[13],Q[2]=U[14],Q}function x0(U,W,Q){let Z=Q??J.create(),F=W*4;return Z[0]=U[F+0],Z[1]=U[F+1],Z[2]=U[F+2],Z}function g0(U,W,Q,Z){let F=Z===U?Z:b(U,Z),Y=Q*4;return F[Y+0]=W[0],F[Y+1]=W[1],F[Y+2]=W[2],F}function z0(U,W){let Q=W??J.create(),Z=U[0],F=U[1],Y=U[2],O=U[4],H=U[5],S=U[6],A=U[8],f=U[9],c=U[10];return Q[0]=Math.sqrt(Z*Z+F*F+Y*Y),Q[1]=Math.sqrt(O*O+H*H+S*S),Q[2]=Math.sqrt(A*A+f*f+c*c),Q}function Y0(U,W,Q,Z,F){let Y=F??new _(16),O=Math.tan(Math.PI*0.5-0.5*U);if(Y[0]=O/W,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=O,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[11]=-1,Y[12]=0,Y[13]=0,Y[15]=0,Number.isFinite(Z)){let H=1/(Q-Z);Y[10]=Z*H,Y[14]=Z*Q*H}else Y[10]=-1,Y[14]=-Q;return Y}function b0(U,W,Q,Z=1/0,F){let Y=F??new _(16),O=1/Math.tan(U*0.5);if(Y[0]=O/W,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=O,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[11]=-1,Y[12]=0,Y[13]=0,Y[15]=0,Z===1/0)Y[10]=0,Y[14]=Q;else{let H=1/(Z-Q);Y[10]=Q*H,Y[14]=Z*Q*H}return Y}function h0(U,W,Q,Z,F,Y,O){let H=O??new _(16);return H[0]=2/(W-U),H[1]=0,H[2]=0,H[3]=0,H[4]=0,H[5]=2/(Z-Q),H[6]=0,H[7]=0,H[8]=0,H[9]=0,H[10]=1/(F-Y),H[11]=0,H[12]=(W+U)/(U-W),H[13]=(Z+Q)/(Q-Z),H[14]=F/(F-Y),H[15]=1,H}function v0(U,W,Q,Z,F,Y,O){let H=O??new _(16),S=W-U,A=Z-Q,f=F-Y;return H[0]=2*F/S,H[1]=0,H[2]=0,H[3]=0,H[4]=0,H[5]=2*F/A,H[6]=0,H[7]=0,H[8]=(U+W)/S,H[9]=(Z+Q)/A,H[10]=Y/f,H[11]=-1,H[12]=0,H[13]=0,H[14]=F*Y/f,H[15]=0,H}function W0(U,W,Q,Z,F,Y=1/0,O){let H=O??new _(16),S=W-U,A=Z-Q;if(H[0]=2*F/S,H[1]=0,H[2]=0,H[3]=0,H[4]=0,H[5]=2*F/A,H[6]=0,H[7]=0,H[8]=(U+W)/S,H[9]=(Z+Q)/A,H[11]=-1,H[12]=0,H[13]=0,H[15]=0,Y===1/0)H[10]=0,H[14]=F;else{let f=1/(Y-F);H[10]=F*f,H[14]=Y*F*f}return H}let w=J.create(),m=J.create(),i=J.create();function N0(U,W,Q,Z){let F=Z??new _(16);return J.normalize(J.subtract(W,U,i),i),J.normalize(J.cross(Q,i,w),w),J.normalize(J.cross(i,w,m),m),F[0]=w[0],F[1]=w[1],F[2]=w[2],F[3]=0,F[4]=m[0],F[5]=m[1],F[6]=m[2],F[7]=0,F[8]=i[0],F[9]=i[1],F[10]=i[2],F[11]=0,F[12]=U[0],F[13]=U[1],F[14]=U[2],F[15]=1,F}function d0(U,W,Q,Z){let F=Z??new _(16);return J.normalize(J.subtract(U,W,i),i),J.normalize(J.cross(Q,i,w),w),J.normalize(J.cross(i,w,m),m),F[0]=w[0],F[1]=w[1],F[2]=w[2],F[3]=0,F[4]=m[0],F[5]=m[1],F[6]=m[2],F[7]=0,F[8]=i[0],F[9]=i[1],F[10]=i[2],F[11]=0,F[12]=U[0],F[13]=U[1],F[14]=U[2],F[15]=1,F}function e(U,W,Q,Z){let F=Z??new _(16);return J.normalize(J.subtract(U,W,i),i),J.normalize(J.cross(Q,i,w),w),J.normalize(J.cross(i,w,m),m),F[0]=w[0],F[1]=m[0],F[2]=i[0],F[3]=0,F[4]=w[1],F[5]=m[1],F[6]=i[1],F[7]=0,F[8]=w[2],F[9]=m[2],F[10]=i[2],F[11]=0,F[12]=-(w[0]*U[0]+w[1]*U[1]+w[2]*U[2]),F[13]=-(m[0]*U[0]+m[1]*U[1]+m[2]*U[2]),F[14]=-(i[0]*U[0]+i[1]*U[1]+i[2]*U[2]),F[15]=1,F}function o0(U,W){let Q=W??new _(16);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=U[0],Q[13]=U[1],Q[14]=U[2],Q[15]=1,Q}function q0(U,W,Q){let Z=Q??new _(16),F=W[0],Y=W[1],O=W[2],H=U[0],S=U[1],A=U[2],f=U[3],c=U[4],C=U[5],u=U[6],y=U[7],d=U[8],p=U[9],v=U[10],n=U[11],a=U[12],K0=U[13],F0=U[14],G0=U[15];if(U!==Z)Z[0]=H,Z[1]=S,Z[2]=A,Z[3]=f,Z[4]=c,Z[5]=C,Z[6]=u,Z[7]=y,Z[8]=d,Z[9]=p,Z[10]=v,Z[11]=n;return Z[12]=H*F+c*Y+d*O+a,Z[13]=S*F+C*Y+p*O+K0,Z[14]=A*F+u*Y+v*O+F0,Z[15]=f*F+y*Y+n*O+G0,Z}function r0(U,W){let Q=W??new _(16),Z=Math.cos(U),F=Math.sin(U);return Q[0]=1,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=Z,Q[6]=F,Q[7]=0,Q[8]=0,Q[9]=-F,Q[10]=Z,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function S0(U,W,Q){let Z=Q??new _(16),F=U[4],Y=U[5],O=U[6],H=U[7],S=U[8],A=U[9],f=U[10],c=U[11],C=Math.cos(W),u=Math.sin(W);if(Z[4]=C*F+u*S,Z[5]=C*Y+u*A,Z[6]=C*O+u*f,Z[7]=C*H+u*c,Z[8]=C*S-u*F,Z[9]=C*A-u*Y,Z[10]=C*f-u*O,Z[11]=C*c-u*H,U!==Z)Z[0]=U[0],Z[1]=U[1],Z[2]=U[2],Z[3]=U[3],Z[12]=U[12],Z[13]=U[13],Z[14]=U[14],Z[15]=U[15];return Z}function y0(U,W){let Q=W??new _(16),Z=Math.cos(U),F=Math.sin(U);return Q[0]=Z,Q[1]=0,Q[2]=-F,Q[3]=0,Q[4]=0,Q[5]=1,Q[6]=0,Q[7]=0,Q[8]=F,Q[9]=0,Q[10]=Z,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function p0(U,W,Q){let Z=Q??new _(16),F=U[0],Y=U[1],O=U[2],H=U[3],S=U[8],A=U[9],f=U[10],c=U[11],C=Math.cos(W),u=Math.sin(W);if(Z[0]=C*F-u*S,Z[1]=C*Y-u*A,Z[2]=C*O-u*f,Z[3]=C*H-u*c,Z[8]=C*S+u*F,Z[9]=C*A+u*Y,Z[10]=C*f+u*O,Z[11]=C*c+u*H,U!==Z)Z[4]=U[4],Z[5]=U[5],Z[6]=U[6],Z[7]=U[7],Z[12]=U[12],Z[13]=U[13],Z[14]=U[14],Z[15]=U[15];return Z}function q(U,W){let Q=W??new _(16),Z=Math.cos(U),F=Math.sin(U);return Q[0]=Z,Q[1]=F,Q[2]=0,Q[3]=0,Q[4]=-F,Q[5]=Z,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=1,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function g(U,W,Q){let Z=Q??new _(16),F=U[0],Y=U[1],O=U[2],H=U[3],S=U[4],A=U[5],f=U[6],c=U[7],C=Math.cos(W),u=Math.sin(W);if(Z[0]=C*F+u*S,Z[1]=C*Y+u*A,Z[2]=C*O+u*f,Z[3]=C*H+u*c,Z[4]=C*S-u*F,Z[5]=C*A-u*Y,Z[6]=C*f-u*O,Z[7]=C*c-u*H,U!==Z)Z[8]=U[8],Z[9]=U[9],Z[10]=U[10],Z[11]=U[11],Z[12]=U[12],Z[13]=U[13],Z[14]=U[14],Z[15]=U[15];return Z}function j(U,W,Q){let Z=Q??new _(16),F=U[0],Y=U[1],O=U[2],H=Math.sqrt(F*F+Y*Y+O*O);F/=H,Y/=H,O/=H;let S=F*F,A=Y*Y,f=O*O,c=Math.cos(W),C=Math.sin(W),u=1-c;return Z[0]=S+(1-S)*c,Z[1]=F*Y*u+O*C,Z[2]=F*O*u-Y*C,Z[3]=0,Z[4]=F*Y*u-O*C,Z[5]=A+(1-A)*c,Z[6]=Y*O*u+F*C,Z[7]=0,Z[8]=F*O*u+Y*C,Z[9]=Y*O*u-F*C,Z[10]=f+(1-f)*c,Z[11]=0,Z[12]=0,Z[13]=0,Z[14]=0,Z[15]=1,Z}let K=j;function B(U,W,Q,Z){let F=Z??new _(16),Y=W[0],O=W[1],H=W[2],S=Math.sqrt(Y*Y+O*O+H*H);Y/=S,O/=S,H/=S;let A=Y*Y,f=O*O,c=H*H,C=Math.cos(Q),u=Math.sin(Q),y=1-C,d=A+(1-A)*C,p=Y*O*y+H*u,v=Y*H*y-O*u,n=Y*O*y-H*u,a=f+(1-f)*C,K0=O*H*y+Y*u,F0=Y*H*y+O*u,G0=O*H*y-Y*u,$0=c+(1-c)*C,M0=U[0],V0=U[1],H0=U[2],j0=U[3],T0=U[4],L0=U[5],k0=U[6],E0=U[7],P0=U[8],l0=U[9],C0=U[10],u0=U[11];if(F[0]=d*M0+p*T0+v*P0,F[1]=d*V0+p*L0+v*l0,F[2]=d*H0+p*k0+v*C0,F[3]=d*j0+p*E0+v*u0,F[4]=n*M0+a*T0+K0*P0,F[5]=n*V0+a*L0+K0*l0,F[6]=n*H0+a*k0+K0*C0,F[7]=n*j0+a*E0+K0*u0,F[8]=F0*M0+G0*T0+$0*P0,F[9]=F0*V0+G0*L0+$0*l0,F[10]=F0*H0+G0*k0+$0*C0,F[11]=F0*j0+G0*E0+$0*u0,U!==F)F[12]=U[12],F[13]=U[13],F[14]=U[14],F[15]=U[15];return F}let X=B;function V(U,W){let Q=W??new _(16);return Q[0]=U[0],Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=U[1],Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=U[2],Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function h(U,W,Q){let Z=Q??new _(16),F=W[0],Y=W[1],O=W[2];if(Z[0]=F*U[0],Z[1]=F*U[1],Z[2]=F*U[2],Z[3]=F*U[3],Z[4]=Y*U[4],Z[5]=Y*U[5],Z[6]=Y*U[6],Z[7]=Y*U[7],Z[8]=O*U[8],Z[9]=O*U[9],Z[10]=O*U[10],Z[11]=O*U[11],U!==Z)Z[12]=U[12],Z[13]=U[13],Z[14]=U[14],Z[15]=U[15];return Z}function N(U,W){let Q=W??new _(16);return Q[0]=U,Q[1]=0,Q[2]=0,Q[3]=0,Q[4]=0,Q[5]=U,Q[6]=0,Q[7]=0,Q[8]=0,Q[9]=0,Q[10]=U,Q[11]=0,Q[12]=0,Q[13]=0,Q[14]=0,Q[15]=1,Q}function k(U,W,Q){let Z=Q??new _(16);if(Z[0]=W*U[0],Z[1]=W*U[1],Z[2]=W*U[2],Z[3]=W*U[3],Z[4]=W*U[4],Z[5]=W*U[5],Z[6]=W*U[6],Z[7]=W*U[7],Z[8]=W*U[8],Z[9]=W*U[9],Z[10]=W*U[10],Z[11]=W*U[11],U!==Z)Z[12]=U[12],Z[13]=U[13],Z[14]=U[14],Z[15]=U[15];return Z}return{add:z,aim:N0,axisRotate:B,axisRotation:j,cameraAim:d0,clone:r,copy:b,create:G,determinant:I0,equals:U0,equalsApproximately:J0,fromMat3:T,fromQuat:L,frustum:v0,frustumReverseZ:W0,getAxis:x0,getScaling:z0,getTranslation:f0,identity:s,inverse:Z0,invert:_0,lookAt:e,mul:c0,mulScalar:x,multiply:B0,multiplyScalar:l,negate:I,ortho:h0,perspective:Y0,perspectiveReverseZ:b0,rotate:X,rotateX:S0,rotateY:p0,rotateZ:g,rotation:K,rotationX:r0,rotationY:y0,rotationZ:q,scale:h,scaling:V,set:$,setAxis:g0,setTranslation:A0,translate:q0,translation:o0,transpose:X0,uniformScale:k,uniformScaling:N}}var cJ=new Map;function iU(_){let J=cJ.get(_);if(!J)J=rU(_),cJ.set(_,J);return J}function DU(_){let J=l_(_);function G(q,g,j,K){let B=new _(4);if(q!==void 0){if(B[0]=q,g!==void 0){if(B[1]=g,j!==void 0){if(B[2]=j,K!==void 0)B[3]=K}}}return B}let $=G;function T(q,g,j,K,B){let X=B??new _(4);return X[0]=q,X[1]=g,X[2]=j,X[3]=K,X}function L(q,g,j){let K=j??new _(4),B=g*0.5,X=Math.sin(B);return K[0]=X*q[0],K[1]=X*q[1],K[2]=X*q[2],K[3]=Math.cos(B),K}function I(q,g){let j=g??J.create(3),K=Math.acos(q[3])*2,B=Math.sin(K*0.5);if(B>o)j[0]=q[0]/B,j[1]=q[1]/B,j[2]=q[2]/B;else j[0]=1,j[1]=0,j[2]=0;return{angle:K,axis:j}}function z(q,g){let j=Y0(q,g);return Math.acos(2*j*j-1)}function l(q,g,j){let K=j??new _(4),B=q[0],X=q[1],V=q[2],h=q[3],N=g[0],k=g[1],U=g[2],W=g[3];return K[0]=B*W+h*N+X*U-V*k,K[1]=X*W+h*k+V*N-B*U,K[2]=V*W+h*U+B*k-X*N,K[3]=h*W-B*N-X*k-V*U,K}let x=l;function b(q,g,j){let K=j??new _(4),B=g*0.5,X=q[0],V=q[1],h=q[2],N=q[3],k=Math.sin(B),U=Math.cos(B);return K[0]=X*U+N*k,K[1]=V*U+h*k,K[2]=h*U-V*k,K[3]=N*U-X*k,K}function r(q,g,j){let K=j??new _(4),B=g*0.5,X=q[0],V=q[1],h=q[2],N=q[3],k=Math.sin(B),U=Math.cos(B);return K[0]=X*U-h*k,K[1]=V*U+N*k,K[2]=h*U+X*k,K[3]=N*U-V*k,K}function J0(q,g,j){let K=j??new _(4),B=g*0.5,X=q[0],V=q[1],h=q[2],N=q[3],k=Math.sin(B),U=Math.cos(B);return K[0]=X*U+V*k,K[1]=V*U-X*k,K[2]=h*U+N*k,K[3]=N*U-h*k,K}function U0(q,g,j,K){let B=K??new _(4),X=q[0],V=q[1],h=q[2],N=q[3],k=g[0],U=g[1],W=g[2],Q=g[3],Z=X*k+V*U+h*W+N*Q;if(Z<0)Z=-Z,k=-k,U=-U,W=-W,Q=-Q;let F,Y;if(1-Z>o){let O=Math.acos(Z),H=Math.sin(O);F=Math.sin((1-j)*O)/H,Y=Math.sin(j*O)/H}else F=1-j,Y=j;return B[0]=F*X+Y*k,B[1]=F*V+Y*U,B[2]=F*h+Y*W,B[3]=F*N+Y*Q,B}function s(q,g){let j=g??new _(4),K=q[0],B=q[1],X=q[2],V=q[3],h=K*K+B*B+X*X+V*V,N=h?1/h:0;return j[0]=-K*N,j[1]=-B*N,j[2]=-X*N,j[3]=V*N,j}function X0(q,g){let j=g??new _(4);return j[0]=-q[0],j[1]=-q[1],j[2]=-q[2],j[3]=q[3],j}function Z0(q,g){let j=g??new _(4),K=q[0]+q[5]+q[10];if(K>0){let B=Math.sqrt(K+1);j[3]=0.5*B;let X=0.5/B;j[0]=(q[6]-q[9])*X,j[1]=(q[8]-q[2])*X,j[2]=(q[1]-q[4])*X}else{let B=0;if(q[5]>q[0])B=1;if(q[10]>q[B*4+B])B=2;let X=(B+1)%3,V=(B+2)%3,h=Math.sqrt(q[B*4+B]-q[X*4+X]-q[V*4+V]+1);j[B]=0.5*h;let N=0.5/h;j[3]=(q[X*4+V]-q[V*4+X])*N,j[X]=(q[X*4+B]+q[B*4+X])*N,j[V]=(q[V*4+B]+q[B*4+V])*N}return j}function I0(q,g,j,K,B){let X=B??new _(4),V=q*0.5,h=g*0.5,N=j*0.5,k=Math.sin(V),U=Math.cos(V),W=Math.sin(h),Q=Math.cos(h),Z=Math.sin(N),F=Math.cos(N);switch(K){case"xyz":X[0]=k*Q*F+U*W*Z,X[1]=U*W*F-k*Q*Z,X[2]=U*Q*Z+k*W*F,X[3]=U*Q*F-k*W*Z;break;case"xzy":X[0]=k*Q*F-U*W*Z,X[1]=U*W*F-k*Q*Z,X[2]=U*Q*Z+k*W*F,X[3]=U*Q*F+k*W*Z;break;case"yxz":X[0]=k*Q*F+U*W*Z,X[1]=U*W*F-k*Q*Z,X[2]=U*Q*Z-k*W*F,X[3]=U*Q*F+k*W*Z;break;case"yzx":X[0]=k*Q*F+U*W*Z,X[1]=U*W*F+k*Q*Z,X[2]=U*Q*Z-k*W*F,X[3]=U*Q*F-k*W*Z;break;case"zxy":X[0]=k*Q*F-U*W*Z,X[1]=U*W*F+k*Q*Z,X[2]=U*Q*Z+k*W*F,X[3]=U*Q*F-k*W*Z;break;case"zyx":X[0]=k*Q*F-U*W*Z,X[1]=U*W*F+k*Q*Z,X[2]=U*Q*Z-k*W*F,X[3]=U*Q*F+k*W*Z;break;default:throw new Error(`Unknown rotation order: ${K}`)}return X}function _0(q,g){let j=g??new _(4);return j[0]=q[0],j[1]=q[1],j[2]=q[2],j[3]=q[3],j}let B0=_0;function c0(q,g,j){let K=j??new _(4);return K[0]=q[0]+g[0],K[1]=q[1]+g[1],K[2]=q[2]+g[2],K[3]=q[3]+g[3],K}function A0(q,g,j){let K=j??new _(4);return K[0]=q[0]-g[0],K[1]=q[1]-g[1],K[2]=q[2]-g[2],K[3]=q[3]-g[3],K}let f0=A0;function x0(q,g,j){let K=j??new _(4);return K[0]=q[0]*g,K[1]=q[1]*g,K[2]=q[2]*g,K[3]=q[3]*g,K}let g0=x0;function z0(q,g,j){let K=j??new _(4);return K[0]=q[0]/g,K[1]=q[1]/g,K[2]=q[2]/g,K[3]=q[3]/g,K}function Y0(q,g){return q[0]*g[0]+q[1]*g[1]+q[2]*g[2]+q[3]*g[3]}function b0(q,g,j,K){let B=K??new _(4);return B[0]=q[0]+j*(g[0]-q[0]),B[1]=q[1]+j*(g[1]-q[1]),B[2]=q[2]+j*(g[2]-q[2]),B[3]=q[3]+j*(g[3]-q[3]),B}function h0(q){let g=q[0],j=q[1],K=q[2],B=q[3];return Math.sqrt(g*g+j*j+K*K+B*B)}let v0=h0;function W0(q){let g=q[0],j=q[1],K=q[2],B=q[3];return g*g+j*j+K*K+B*B}let w=W0;function m(q,g){let j=g??new _(4),K=q[0],B=q[1],X=q[2],V=q[3],h=Math.sqrt(K*K+B*B+X*X+V*V);if(h>0.00001)j[0]=K/h,j[1]=B/h,j[2]=X/h,j[3]=V/h;else j[0]=0,j[1]=0,j[2]=0,j[3]=1;return j}function i(q,g){return Math.abs(q[0]-g[0])<o&&Math.abs(q[1]-g[1])<o&&Math.abs(q[2]-g[2])<o&&Math.abs(q[3]-g[3])<o}function N0(q,g){return q[0]===g[0]&&q[1]===g[1]&&q[2]===g[2]&&q[3]===g[3]}function d0(q){let g=q??new _(4);return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g}let e=J.create(),o0=J.create(),q0=J.create();function r0(q,g,j){let K=j??new _(4),B=J.dot(q,g);if(B<-0.999999){if(J.cross(o0,q,e),J.len(e)<0.000001)J.cross(q0,q,e);return J.normalize(e,e),L(e,Math.PI,K),K}else if(B>0.999999)return K[0]=0,K[1]=0,K[2]=0,K[3]=1,K;else return J.cross(q,g,e),K[0]=e[0],K[1]=e[1],K[2]=e[2],K[3]=1+B,m(K,K)}let S0=new _(4),y0=new _(4);function p0(q,g,j,K,B,X){let V=X??new _(4);return U0(q,K,B,S0),U0(g,j,B,y0),U0(S0,y0,2*B*(1-B),V),V}return{create:G,fromValues:$,set:T,fromAxisAngle:L,toAxisAngle:I,angle:z,multiply:l,mul:x,rotateX:b,rotateY:r,rotateZ:J0,slerp:U0,inverse:s,conjugate:X0,fromMat:Z0,fromEuler:I0,copy:_0,clone:B0,add:c0,subtract:A0,sub:f0,mulScalar:x0,scale:g0,divScalar:z0,dot:Y0,lerp:b0,length:h0,len:v0,lengthSq:W0,lenSq:w,normalize:m,equalsApproximately:i,equals:N0,identity:d0,rotationTo:r0,sqlerp:p0}}var xJ=new Map;function wU(_){let J=xJ.get(_);if(!J)J=DU(_),xJ.set(_,J);return J}function mU(_){function J(j,K,B,X){let V=new _(4);if(j!==void 0){if(V[0]=j,K!==void 0){if(V[1]=K,B!==void 0){if(V[2]=B,X!==void 0)V[3]=X}}}return V}let G=J;function $(j,K,B,X,V){let h=V??new _(4);return h[0]=j,h[1]=K,h[2]=B,h[3]=X,h}function T(j,K){let B=K??new _(4);return B[0]=Math.ceil(j[0]),B[1]=Math.ceil(j[1]),B[2]=Math.ceil(j[2]),B[3]=Math.ceil(j[3]),B}function L(j,K){let B=K??new _(4);return B[0]=Math.floor(j[0]),B[1]=Math.floor(j[1]),B[2]=Math.floor(j[2]),B[3]=Math.floor(j[3]),B}function I(j,K){let B=K??new _(4);return B[0]=Math.round(j[0]),B[1]=Math.round(j[1]),B[2]=Math.round(j[2]),B[3]=Math.round(j[3]),B}function z(j,K=0,B=1,X){let V=X??new _(4);return V[0]=Math.min(B,Math.max(K,j[0])),V[1]=Math.min(B,Math.max(K,j[1])),V[2]=Math.min(B,Math.max(K,j[2])),V[3]=Math.min(B,Math.max(K,j[3])),V}function l(j,K,B){let X=B??new _(4);return X[0]=j[0]+K[0],X[1]=j[1]+K[1],X[2]=j[2]+K[2],X[3]=j[3]+K[3],X}function x(j,K,B,X){let V=X??new _(4);return V[0]=j[0]+K[0]*B,V[1]=j[1]+K[1]*B,V[2]=j[2]+K[2]*B,V[3]=j[3]+K[3]*B,V}function b(j,K,B){let X=B??new _(4);return X[0]=j[0]-K[0],X[1]=j[1]-K[1],X[2]=j[2]-K[2],X[3]=j[3]-K[3],X}let r=b;function J0(j,K){return Math.abs(j[0]-K[0])<o&&Math.abs(j[1]-K[1])<o&&Math.abs(j[2]-K[2])<o&&Math.abs(j[3]-K[3])<o}function U0(j,K){return j[0]===K[0]&&j[1]===K[1]&&j[2]===K[2]&&j[3]===K[3]}function s(j,K,B,X){let V=X??new _(4);return V[0]=j[0]+B*(K[0]-j[0]),V[1]=j[1]+B*(K[1]-j[1]),V[2]=j[2]+B*(K[2]-j[2]),V[3]=j[3]+B*(K[3]-j[3]),V}function X0(j,K,B,X){let V=X??new _(4);return V[0]=j[0]+B[0]*(K[0]-j[0]),V[1]=j[1]+B[1]*(K[1]-j[1]),V[2]=j[2]+B[2]*(K[2]-j[2]),V[3]=j[3]+B[3]*(K[3]-j[3]),V}function Z0(j,K,B){let X=B??new _(4);return X[0]=Math.max(j[0],K[0]),X[1]=Math.max(j[1],K[1]),X[2]=Math.max(j[2],K[2]),X[3]=Math.max(j[3],K[3]),X}function I0(j,K,B){let X=B??new _(4);return X[0]=Math.min(j[0],K[0]),X[1]=Math.min(j[1],K[1]),X[2]=Math.min(j[2],K[2]),X[3]=Math.min(j[3],K[3]),X}function _0(j,K,B){let X=B??new _(4);return X[0]=j[0]*K,X[1]=j[1]*K,X[2]=j[2]*K,X[3]=j[3]*K,X}let B0=_0;function c0(j,K,B){let X=B??new _(4);return X[0]=j[0]/K,X[1]=j[1]/K,X[2]=j[2]/K,X[3]=j[3]/K,X}function A0(j,K){let B=K??new _(4);return B[0]=1/j[0],B[1]=1/j[1],B[2]=1/j[2],B[3]=1/j[3],B}let f0=A0;function x0(j,K){return j[0]*K[0]+j[1]*K[1]+j[2]*K[2]+j[3]*K[3]}function g0(j){let K=j[0],B=j[1],X=j[2],V=j[3];return Math.sqrt(K*K+B*B+X*X+V*V)}let z0=g0;function Y0(j){let K=j[0],B=j[1],X=j[2],V=j[3];return K*K+B*B+X*X+V*V}let b0=Y0;function h0(j,K){let B=j[0]-K[0],X=j[1]-K[1],V=j[2]-K[2],h=j[3]-K[3];return Math.sqrt(B*B+X*X+V*V+h*h)}let v0=h0;function W0(j,K){let B=j[0]-K[0],X=j[1]-K[1],V=j[2]-K[2],h=j[3]-K[3];return B*B+X*X+V*V+h*h}let w=W0;function m(j,K){let B=K??new _(4),X=j[0],V=j[1],h=j[2],N=j[3],k=Math.sqrt(X*X+V*V+h*h+N*N);if(k>0.00001)B[0]=X/k,B[1]=V/k,B[2]=h/k,B[3]=N/k;else B[0]=0,B[1]=0,B[2]=0,B[3]=0;return B}function i(j,K){let B=K??new _(4);return B[0]=-j[0],B[1]=-j[1],B[2]=-j[2],B[3]=-j[3],B}function N0(j,K){let B=K??new _(4);return B[0]=j[0],B[1]=j[1],B[2]=j[2],B[3]=j[3],B}let d0=N0;function e(j,K,B){let X=B??new _(4);return X[0]=j[0]*K[0],X[1]=j[1]*K[1],X[2]=j[2]*K[2],X[3]=j[3]*K[3],X}let o0=e;function q0(j,K,B){let X=B??new _(4);return X[0]=j[0]/K[0],X[1]=j[1]/K[1],X[2]=j[2]/K[2],X[3]=j[3]/K[3],X}let r0=q0;function S0(j){let K=j??new _(4);return K[0]=0,K[1]=0,K[2]=0,K[3]=0,K}function y0(j,K,B){let X=B??new _(4),V=j[0],h=j[1],N=j[2],k=j[3];return X[0]=K[0]*V+K[4]*h+K[8]*N+K[12]*k,X[1]=K[1]*V+K[5]*h+K[9]*N+K[13]*k,X[2]=K[2]*V+K[6]*h+K[10]*N+K[14]*k,X[3]=K[3]*V+K[7]*h+K[11]*N+K[15]*k,X}function p0(j,K,B){let X=B??new _(4);return m(j,X),_0(X,K,X)}function q(j,K,B){let X=B??new _(4);if(g0(j)>K)return p0(j,K,X);return N0(j,X)}function g(j,K,B){let X=B??new _(4);return s(j,K,0.5,X)}return{create:J,fromValues:G,set:$,ceil:T,floor:L,round:I,clamp:z,add:l,addScaled:x,subtract:b,sub:r,equalsApproximately:J0,equals:U0,lerp:s,lerpV:X0,max:Z0,min:I0,mulScalar:_0,scale:B0,divScalar:c0,inverse:A0,invert:f0,dot:x0,length:g0,len:z0,lengthSq:Y0,lenSq:b0,distance:h0,dist:v0,distanceSq:W0,distSq:w,normalize:m,negate:i,copy:N0,clone:d0,multiply:e,mul:o0,divide:q0,div:r0,zero:S0,transformMat4:y0,setLength:p0,truncate:q,midpoint:g}}var yJ=new Map;function aU(_){let J=yJ.get(_);if(!J)J=mU(_),yJ.set(_,J);return J}function m_(_,J,G,$,T,L){return{mat3:oU(_),mat4:iU(J),quat:wU(G),vec2:pJ($),vec3:l_(T),vec4:aU(L)}}var{mat3:NK,mat4:C_,quat:LK,vec2:kK,vec3:a_,vec4:EK}=m_(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array),{mat3:PK,mat4:RK,quat:qK,vec2:SK,vec3:IK,vec4:AK}=m_(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array),{mat3:fK,mat4:gK,quat:zK,vec2:lK,vec3:CK,vec4:uK}=m_(pU,Array,Array,Array,Array,Array);var ZJ=(_,J)=>((_+J-1)/J|0)*J;function nU(_){return Object.keys(_)}function eU(_,J){return new Array(_).fill(0).map((G,$)=>J($))}var bJ=(_)=>_&&typeof _.length==="number"&&_.buffer instanceof ArrayBuffer&&typeof _.byteLength==="number",oJ=(_)=>_,D=oJ({i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}}),Q_=oJ({...D,"atomic<i32>":D.i32,"atomic<u32>":D.u32,"vec2<i32>":D.vec2i,"vec2<u32>":D.vec2u,"vec2<f32>":D.vec2f,"vec2<f16>":D.vec2h,"vec3<i32>":D.vec3i,"vec3<u32>":D.vec3u,"vec3<f32>":D.vec3f,"vec3<f16>":D.vec3h,"vec4<i32>":D.vec4i,"vec4<u32>":D.vec4u,"vec4<f32>":D.vec4f,"vec4<f16>":D.vec4h,"mat2x2<f32>":D.mat2x2f,"mat2x2<f16>":D.mat2x2h,"mat3x2<f32>":D.mat3x2f,"mat3x2<f16>":D.mat3x2h,"mat4x2<f32>":D.mat4x2f,"mat4x2<f16>":D.mat4x2h,"mat2x3<f32>":D.mat2x3f,"mat2x3<f16>":D.mat2x3h,"mat3x3<f32>":D.mat3x3f,"mat3x3<f16>":D.mat3x3h,"mat4x3<f32>":D.mat4x3f,"mat4x3<f16>":D.mat4x3h,"mat2x4<f32>":D.mat2x4f,"mat2x4<f16>":D.mat2x4h,"mat3x4<f32>":D.mat3x4f,"mat3x4<f16>":D.mat3x4h,"mat4x4<f32>":D.mat4x4f,"mat4x4<f16>":D.mat4x4h}),tU=nU(Q_);function sU(_=[],J){let G=new Set;for(let $ of tU){let T=Q_[$];if(!G.has(T))G.add(T),T.flatten=_.includes($)?J:!J}}sU();function _K(_){let J=_;if(J.elementType)return J.size;else{let $=_,T=J.numElements||1;if($.fields)return _.size*T;else{let L=_,{align:I}=Q_[L.type];return T>1?ZJ(_.size,I)*T:_.size}}}function vJ(_,J,G,$){let{size:T,type:L}=_;try{let{View:I,align:z,size:l}=Q_[L],x=$!==void 0,b=x?ZJ(T,z):l,r=b/I.BYTES_PER_ELEMENT,J0=x?$===0?(J.byteLength-G)/b:$:1;return new I(J,G,r*J0)}catch{throw new Error(`unknown type: ${L}`)}}function JK(_){return!_.fields&&!_.elementType}function UK(_,J,G){let $=G||0,T=J||new ArrayBuffer(_K(_)),L=(I,z)=>{let l=I,x=l.elementType;if(x)if(JK(x)&&Q_[x.type].flatten)return vJ(x,T,z,l.numElements);else{let{size:b}=$J(I),r=l.numElements===0?(T.byteLength-z)/b:l.numElements;return eU(r,(J0)=>L(x,z+b*J0))}else if(typeof I==="string")throw Error("unreachable");else{let b=I.fields;if(b){let r={};for(let[J0,{type:U0,offset:s}]of Object.entries(b))r[J0]=L(U0,z+s);return r}else return vJ(I,T,z)}};return{views:L(_,$),arrayBuffer:T}}function t_(_,J){if(_===void 0)return;else if(bJ(J)){let G=J;if(G.length===1&&typeof _==="number")G[0]=_;else if(Array.isArray(_[0])||bJ(_[0])){let $=_[0].length,T=$===3?4:$;for(let L=0;L<_.length;++L){let I=L*T;G.set(_[L],I)}}else G.set(_)}else if(Array.isArray(J)){let G=J;_.forEach(($,T)=>{t_($,G[T])})}else{let G=J;for(let[$,T]of Object.entries(_)){let L=G[$];if(L)t_(T,L)}}}function YJ(_,J,G=0){let $=_,T=$.group===void 0?_:$.typeDefinition,L=UK(T,J,G);return{...L,set(I){t_(I,L.views)}}}function s_(_){let G=_.elementType;if(G)return s_(G);let T=_.fields;if(T)return Object.values(T).reduce((z,{type:l})=>Math.max(z,s_(l)),0);let{type:L}=_,{align:I}=Q_[L];return I}function $J(_){let G=_.elementType;if(G){let L=G.size,I=s_(G);return{unalignedSize:L,align:I,size:ZJ(L,I)}}let T=_.fields;if(T){let L=Object.values(T).pop();if(L.type.size===0)return $J(L.type)}return{size:0,unalignedSize:0,align:1}}function rJ(_){let J=_,G=J.group===void 0?_:J.typeDefinition;return $J(G)}class iJ{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class m0{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(_){throw new Error("Cannot evaluate node")}evaluateString(_){return this.evaluate(_).toString()}search(_){}searchBlock(_,J){if(_){J(j_.instance);for(let G of _)if(G instanceof Array)this.searchBlock(G,J);else G.search(J);J(T_.instance)}}}class j_ extends m0{}j_.instance=new j_;class T_ extends m0{}T_.instance=new T_;class t extends m0{constructor(){super()}}class c_ extends t{constructor(_,J,G,$,T,L){super();this.calls=new Set,this.name=_,this.args=J,this.returnType=G,this.body=$,this.startLine=T,this.endLine=L}get astNodeType(){return"function"}search(_){this.searchBlock(this.body,_)}}class DJ extends t{constructor(_){super();this.expression=_}get astNodeType(){return"staticAssert"}search(_){this.expression.search(_)}}class wJ extends t{constructor(_,J){super();this.condition=_,this.body=J}get astNodeType(){return"while"}search(_){this.condition.search(_),this.searchBlock(this.body,_)}}class mJ extends t{constructor(_){super();this.body=_}get astNodeType(){return"continuing"}search(_){this.searchBlock(this.body,_)}}class aJ extends t{constructor(_,J,G,$){super();this.init=_,this.condition=J,this.increment=G,this.body=$}get astNodeType(){return"for"}search(_){var J,G,$;(J=this.init)===null||J===void 0||J.search(_),(G=this.condition)===null||G===void 0||G.search(_),($=this.increment)===null||$===void 0||$.search(_),this.searchBlock(this.body,_)}}class s0 extends t{constructor(_,J,G,$,T){super();this.name=_,this.type=J,this.storage=G,this.access=$,this.value=T}get astNodeType(){return"var"}search(_){var J;_(this),(J=this.value)===null||J===void 0||J.search(_)}}class BJ extends t{constructor(_,J,G){super();this.name=_,this.type=J,this.value=G}get astNodeType(){return"override"}search(_){var J;(J=this.value)===null||J===void 0||J.search(_)}}class x_ extends t{constructor(_,J,G,$,T){super();this.name=_,this.type=J,this.storage=G,this.access=$,this.value=T}get astNodeType(){return"let"}search(_){var J;_(this),(J=this.value)===null||J===void 0||J.search(_)}}class _J extends t{constructor(_,J,G,$,T){super();this.name=_,this.type=J,this.storage=G,this.access=$,this.value=T}get astNodeType(){return"const"}evaluate(_){return this.value.evaluate(_)}search(_){var J;_(this),(J=this.value)===null||J===void 0||J.search(_)}}var G_;(function(_){_.increment="++",_.decrement="--"})(G_||(G_={}));(function(_){function J(G){let $=G;if($=="parse")throw new Error("Invalid value for IncrementOperator");return _[$]}_.parse=J})(G_||(G_={}));class nJ extends t{constructor(_,J){super();this.operator=_,this.variable=J}get astNodeType(){return"increment"}search(_){this.variable.search(_)}}var O_;(function(_){_.assign="=",_.addAssign="+=",_.subtractAssin="-=",_.multiplyAssign="*=",_.divideAssign="/=",_.moduloAssign="%=",_.andAssign="&=",_.orAssign="|=",_.xorAssign="^=",_.shiftLeftAssign="<<=",_.shiftRightAssign=">>="})(O_||(O_={}));(function(_){function J(G){let $=G;if($=="parse")throw new Error("Invalid value for AssignOperator");return $}_.parse=J})(O_||(O_={}));class eJ extends t{constructor(_,J,G){super();this.operator=_,this.variable=J,this.value=G}get astNodeType(){return"assign"}search(_){this.variable.search(_),this.value.search(_)}}class WJ extends t{constructor(_,J){super();this.name=_,this.args=J}get astNodeType(){return"call"}search(_){for(let J of this.args)J.search(_);_(this)}}class tJ extends t{constructor(_,J){super();this.body=_,this.continuing=J}get astNodeType(){return"loop"}}class sJ extends t{constructor(_,J){super();this.condition=_,this.body=J}get astNodeType(){return"body"}}class _U extends t{constructor(_,J,G,$){super();this.condition=_,this.body=J,this.elseif=G,this.else=$}get astNodeType(){return"if"}search(_){this.condition.search(_),this.searchBlock(this.body,_),this.searchBlock(this.elseif,_),this.searchBlock(this.else,_)}}class JU extends t{constructor(_){super();this.value=_}get astNodeType(){return"return"}search(_){var J;(J=this.value)===null||J===void 0||J.search(_)}}class UU extends t{constructor(_){super();this.name=_}get astNodeType(){return"enable"}}class KU extends t{constructor(_){super();this.extensions=_}get astNodeType(){return"requires"}}class FU extends t{constructor(_,J){super();this.severity=_,this.rule=J}get astNodeType(){return"diagnostic"}}class MJ extends t{constructor(_,J){super();this.name=_,this.type=J}get astNodeType(){return"alias"}}class GU extends t{constructor(){super()}get astNodeType(){return"discard"}}class QU extends t{constructor(){super()}get astNodeType(){return"break"}}class XU extends t{constructor(){super()}get astNodeType(){return"continue"}}class __ extends t{constructor(_){super();this.name=_}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class t0 extends __{constructor(_,J,G,$){super(_);this.members=J,this.startLine=G,this.endLine=$}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(_){for(let J=0;J<this.members.length;J++)if(this.members[J].name==_)return J;return-1}}class VJ extends __{constructor(_,J,G){super(_);this.format=J,this.access=G}get astNodeType(){return"template"}}class ZU extends __{constructor(_,J,G,$){super(_);this.storage=J,this.type=G,this.access=$}get astNodeType(){return"pointer"}}class HJ extends __{constructor(_,J,G,$){super(_);this.attributes=J,this.format=G,this.count=$}get astNodeType(){return"array"}get isArray(){return!0}}class F_ extends __{constructor(_,J,G){super(_);this.format=J,this.access=G}get astNodeType(){return"sampler"}}class w0 extends m0{constructor(){super()}}class YU extends w0{constructor(_){super();this.value=_}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class J_ extends w0{constructor(_,J){super();this.type=_,this.args=J}get astNodeType(){return"createExpr"}search(_){if(_(this),this.args)for(let J of this.args)J.search(_)}evaluate(_){return this.args[0].evaluate(_)}}class jJ extends w0{constructor(_,J){super();this.name=_,this.args=J}get astNodeType(){return"callExpr"}evaluate(_){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(_));case"acos":return Math.acos(this.args[0].evaluate(_));case"acosh":return Math.acosh(this.args[0].evaluate(_));case"asin":return Math.asin(this.args[0].evaluate(_));case"asinh":return Math.asinh(this.args[0].evaluate(_));case"atan":return Math.atan(this.args[0].evaluate(_));case"atan2":return Math.atan2(this.args[0].evaluate(_),this.args[1].evaluate(_));case"atanh":return Math.atanh(this.args[0].evaluate(_));case"ceil":return Math.ceil(this.args[0].evaluate(_));case"clamp":return Math.min(Math.max(this.args[0].evaluate(_),this.args[1].evaluate(_)),this.args[2].evaluate(_));case"cos":return Math.cos(this.args[0].evaluate(_));case"degrees":return this.args[0].evaluate(_)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(_)-this.args[1].evaluate(_),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(_));case"exp2":return Math.pow(2,this.args[0].evaluate(_));case"floor":return Math.floor(this.args[0].evaluate(_));case"fma":return this.args[0].evaluate(_)*this.args[1].evaluate(_)+this.args[2].evaluate(_);case"fract":return this.args[0].evaluate(_)-Math.floor(this.args[0].evaluate(_));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(_));case"log":return Math.log(this.args[0].evaluate(_));case"log2":return Math.log2(this.args[0].evaluate(_));case"max":return Math.max(this.args[0].evaluate(_),this.args[1].evaluate(_));case"min":return Math.min(this.args[0].evaluate(_),this.args[1].evaluate(_));case"mix":return this.args[0].evaluate(_)*(1-this.args[2].evaluate(_))+this.args[1].evaluate(_)*this.args[2].evaluate(_);case"modf":return this.args[0].evaluate(_)-Math.floor(this.args[0].evaluate(_));case"pow":return Math.pow(this.args[0].evaluate(_),this.args[1].evaluate(_));case"radians":return this.args[0].evaluate(_)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(_));case"sign":return Math.sign(this.args[0].evaluate(_));case"sin":return Math.sin(this.args[0].evaluate(_));case"sinh":return Math.sinh(this.args[0].evaluate(_));case"saturate":return Math.min(Math.max(this.args[0].evaluate(_),0),1);case"smoothstep":return this.args[0].evaluate(_)*this.args[0].evaluate(_)*(3-2*this.args[0].evaluate(_));case"sqrt":return Math.sqrt(this.args[0].evaluate(_));case"step":return this.args[0].evaluate(_)<this.args[1].evaluate(_)?0:1;case"tan":return Math.tan(this.args[0].evaluate(_));case"tanh":return Math.tanh(this.args[0].evaluate(_));case"trunc":return Math.trunc(this.args[0].evaluate(_));default:throw new Error("Non const function: "+this.name)}}search(_){for(let J of this.args)J.search(_);_(this)}}class y_ extends w0{constructor(_){super();this.name=_}get astNodeType(){return"varExpr"}search(_){if(_(this),this.postfix)this.postfix.search(_)}evaluate(_){let J=_.constants.get(this.name);if(!J)throw new Error("Cannot evaluate node");return J.evaluate(_)}}class JJ extends w0{constructor(_,J){super();this.name=_,this.initializer=J}get astNodeType(){return"constExpr"}evaluate(_){var J,G;if(this.initializer instanceof J_){let $=(J=this.postfix)===null||J===void 0?void 0:J.evaluateString(_),T=(G=this.initializer.type)===null||G===void 0?void 0:G.name,L=_.structs.get(T),I=L===null||L===void 0?void 0:L.getMemberIndex($);if(I!==void 0&&I!=-1)return this.initializer.args[I].evaluate(_);else return this.initializer.evaluate(_)}return this.initializer.evaluate(_)}search(_){this.initializer.search(_)}}class UJ extends w0{constructor(_){super();this.value=_}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class $U extends w0{constructor(_,J){super();this.type=_,this.value=J}get astNodeType(){return"bitcastExpr"}search(_){this.value.search(_)}}class KJ extends w0{constructor(_){super();this.contents=_}get astNodeType(){return"groupExpr"}evaluate(_){return this.contents[0].evaluate(_)}search(_){this.searchBlock(this.contents,_)}}class BU extends w0{constructor(_){super();this.index=_}search(_){this.index.search(_)}}class TJ extends w0{constructor(){super()}}class WU extends TJ{constructor(_,J){super();this.operator=_,this.right=J}get astNodeType(){return"unaryOp"}evaluate(_){switch(this.operator){case"+":return this.right.evaluate(_);case"-":return-this.right.evaluate(_);case"!":return this.right.evaluate(_)?0:1;case"~":return~this.right.evaluate(_);default:throw new Error("Unknown unary operator: "+this.operator)}}search(_){this.right.search(_)}}class D0 extends TJ{constructor(_,J,G){super();this.operator=_,this.left=J,this.right=G}get astNodeType(){return"binaryOp"}evaluate(_){switch(this.operator){case"+":return this.left.evaluate(_)+this.right.evaluate(_);case"-":return this.left.evaluate(_)-this.right.evaluate(_);case"*":return this.left.evaluate(_)*this.right.evaluate(_);case"/":return this.left.evaluate(_)/this.right.evaluate(_);case"%":return this.left.evaluate(_)%this.right.evaluate(_);case"==":return this.left.evaluate(_)==this.right.evaluate(_)?1:0;case"!=":return this.left.evaluate(_)!=this.right.evaluate(_)?1:0;case"<":return this.left.evaluate(_)<this.right.evaluate(_)?1:0;case">":return this.left.evaluate(_)>this.right.evaluate(_)?1:0;case"<=":return this.left.evaluate(_)<=this.right.evaluate(_)?1:0;case">=":return this.left.evaluate(_)>=this.right.evaluate(_)?1:0;case"&&":return this.left.evaluate(_)&&this.right.evaluate(_)?1:0;case"||":return this.left.evaluate(_)||this.right.evaluate(_)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(_){this.left.search(_),this.right.search(_)}}class OJ extends m0{constructor(){super()}}class MU extends OJ{constructor(_,J){super();this.selector=_,this.body=J}get astNodeType(){return"case"}search(_){this.searchBlock(this.body,_)}}class VU extends OJ{constructor(_){super();this.body=_}get astNodeType(){return"default"}search(_){this.searchBlock(this.body,_)}}class HU extends m0{constructor(_,J,G){super();this.name=_,this.type=J,this.attributes=G}get astNodeType(){return"argument"}}class jU extends m0{constructor(_,J){super();this.condition=_,this.body=J}get astNodeType(){return"elseif"}search(_){this.condition.search(_),this.searchBlock(this.body,_)}}class TU extends m0{constructor(_,J,G){super();this.name=_,this.type=J,this.attributes=G}get astNodeType(){return"member"}}class OU extends m0{constructor(_,J){super();this.name=_,this.value=J}get astNodeType(){return"attribute"}}var R,E;(function(_){_[_.token=0]="token",_[_.keyword=1]="keyword",_[_.reserved=2]="reserved"})(E||(E={}));class P{constructor(_,J,G){this.name=_,this.type=J,this.rule=G}toString(){return this.name}}class M{}R=M;M.none=new P("",E.reserved,"");M.eof=new P("EOF",E.token,"");M.reserved={asm:new P("asm",E.reserved,"asm"),bf16:new P("bf16",E.reserved,"bf16"),do:new P("do",E.reserved,"do"),enum:new P("enum",E.reserved,"enum"),f16:new P("f16",E.reserved,"f16"),f64:new P("f64",E.reserved,"f64"),handle:new P("handle",E.reserved,"handle"),i8:new P("i8",E.reserved,"i8"),i16:new P("i16",E.reserved,"i16"),i64:new P("i64",E.reserved,"i64"),mat:new P("mat",E.reserved,"mat"),premerge:new P("premerge",E.reserved,"premerge"),regardless:new P("regardless",E.reserved,"regardless"),typedef:new P("typedef",E.reserved,"typedef"),u8:new P("u8",E.reserved,"u8"),u16:new P("u16",E.reserved,"u16"),u64:new P("u64",E.reserved,"u64"),unless:new P("unless",E.reserved,"unless"),using:new P("using",E.reserved,"using"),vec:new P("vec",E.reserved,"vec"),void:new P("void",E.reserved,"void")};M.keywords={array:new P("array",E.keyword,"array"),atomic:new P("atomic",E.keyword,"atomic"),bool:new P("bool",E.keyword,"bool"),f32:new P("f32",E.keyword,"f32"),i32:new P("i32",E.keyword,"i32"),mat2x2:new P("mat2x2",E.keyword,"mat2x2"),mat2x3:new P("mat2x3",E.keyword,"mat2x3"),mat2x4:new P("mat2x4",E.keyword,"mat2x4"),mat3x2:new P("mat3x2",E.keyword,"mat3x2"),mat3x3:new P("mat3x3",E.keyword,"mat3x3"),mat3x4:new P("mat3x4",E.keyword,"mat3x4"),mat4x2:new P("mat4x2",E.keyword,"mat4x2"),mat4x3:new P("mat4x3",E.keyword,"mat4x3"),mat4x4:new P("mat4x4",E.keyword,"mat4x4"),ptr:new P("ptr",E.keyword,"ptr"),sampler:new P("sampler",E.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",E.keyword,"sampler_comparison"),struct:new P("struct",E.keyword,"struct"),texture_1d:new P("texture_1d",E.keyword,"texture_1d"),texture_2d:new P("texture_2d",E.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",E.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",E.keyword,"texture_3d"),texture_cube:new P("texture_cube",E.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",E.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",E.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",E.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",E.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",E.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",E.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",E.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",E.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",E.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",E.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",E.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",E.keyword,"texture_external"),u32:new P("u32",E.keyword,"u32"),vec2:new P("vec2",E.keyword,"vec2"),vec3:new P("vec3",E.keyword,"vec3"),vec4:new P("vec4",E.keyword,"vec4"),bitcast:new P("bitcast",E.keyword,"bitcast"),block:new P("block",E.keyword,"block"),break:new P("break",E.keyword,"break"),case:new P("case",E.keyword,"case"),continue:new P("continue",E.keyword,"continue"),continuing:new P("continuing",E.keyword,"continuing"),default:new P("default",E.keyword,"default"),diagnostic:new P("diagnostic",E.keyword,"diagnostic"),discard:new P("discard",E.keyword,"discard"),else:new P("else",E.keyword,"else"),enable:new P("enable",E.keyword,"enable"),fallthrough:new P("fallthrough",E.keyword,"fallthrough"),false:new P("false",E.keyword,"false"),fn:new P("fn",E.keyword,"fn"),for:new P("for",E.keyword,"for"),function:new P("function",E.keyword,"function"),if:new P("if",E.keyword,"if"),let:new P("let",E.keyword,"let"),const:new P("const",E.keyword,"const"),loop:new P("loop",E.keyword,"loop"),while:new P("while",E.keyword,"while"),private:new P("private",E.keyword,"private"),read:new P("read",E.keyword,"read"),read_write:new P("read_write",E.keyword,"read_write"),return:new P("return",E.keyword,"return"),requires:new P("requires",E.keyword,"requires"),storage:new P("storage",E.keyword,"storage"),switch:new P("switch",E.keyword,"switch"),true:new P("true",E.keyword,"true"),alias:new P("alias",E.keyword,"alias"),type:new P("type",E.keyword,"type"),uniform:new P("uniform",E.keyword,"uniform"),var:new P("var",E.keyword,"var"),override:new P("override",E.keyword,"override"),workgroup:new P("workgroup",E.keyword,"workgroup"),write:new P("write",E.keyword,"write"),r8unorm:new P("r8unorm",E.keyword,"r8unorm"),r8snorm:new P("r8snorm",E.keyword,"r8snorm"),r8uint:new P("r8uint",E.keyword,"r8uint"),r8sint:new P("r8sint",E.keyword,"r8sint"),r16uint:new P("r16uint",E.keyword,"r16uint"),r16sint:new P("r16sint",E.keyword,"r16sint"),r16float:new P("r16float",E.keyword,"r16float"),rg8unorm:new P("rg8unorm",E.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",E.keyword,"rg8snorm"),rg8uint:new P("rg8uint",E.keyword,"rg8uint"),rg8sint:new P("rg8sint",E.keyword,"rg8sint"),r32uint:new P("r32uint",E.keyword,"r32uint"),r32sint:new P("r32sint",E.keyword,"r32sint"),r32float:new P("r32float",E.keyword,"r32float"),rg16uint:new P("rg16uint",E.keyword,"rg16uint"),rg16sint:new P("rg16sint",E.keyword,"rg16sint"),rg16float:new P("rg16float",E.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",E.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",E.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",E.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",E.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",E.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",E.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",E.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",E.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",E.keyword,"rg11b10float"),rg32uint:new P("rg32uint",E.keyword,"rg32uint"),rg32sint:new P("rg32sint",E.keyword,"rg32sint"),rg32float:new P("rg32float",E.keyword,"rg32float"),rgba16uint:new P("rgba16uint",E.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",E.keyword,"rgba16sint"),rgba16float:new P("rgba16float",E.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",E.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",E.keyword,"rgba32sint"),rgba32float:new P("rgba32float",E.keyword,"rgba32float"),static_assert:new P("static_assert",E.keyword,"static_assert")};M.tokens={decimal_float_literal:new P("decimal_float_literal",E.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|(-?[0-9]+f)/),hex_float_literal:new P("hex_float_literal",E.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",E.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",E.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",E.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",E.token,"&"),and_and:new P("and_and",E.token,"&&"),arrow:new P("arrow ",E.token,"->"),attr:new P("attr",E.token,"@"),forward_slash:new P("forward_slash",E.token,"/"),bang:new P("bang",E.token,"!"),bracket_left:new P("bracket_left",E.token,"["),bracket_right:new P("bracket_right",E.token,"]"),brace_left:new P("brace_left",E.token,"{"),brace_right:new P("brace_right",E.token,"}"),colon:new P("colon",E.token,":"),comma:new P("comma",E.token,","),equal:new P("equal",E.token,"="),equal_equal:new P("equal_equal",E.token,"=="),not_equal:new P("not_equal",E.token,"!="),greater_than:new P("greater_than",E.token,">"),greater_than_equal:new P("greater_than_equal",E.token,">="),shift_right:new P("shift_right",E.token,">>"),less_than:new P("less_than",E.token,"<"),less_than_equal:new P("less_than_equal",E.token,"<="),shift_left:new P("shift_left",E.token,"<<"),modulo:new P("modulo",E.token,"%"),minus:new P("minus",E.token,"-"),minus_minus:new P("minus_minus",E.token,"--"),period:new P("period",E.token,"."),plus:new P("plus",E.token,"+"),plus_plus:new P("plus_plus",E.token,"++"),or:new P("or",E.token,"|"),or_or:new P("or_or",E.token,"||"),paren_left:new P("paren_left",E.token,"("),paren_right:new P("paren_right",E.token,")"),semicolon:new P("semicolon",E.token,";"),star:new P("star",E.token,"*"),tilde:new P("tilde",E.token,"~"),underscore:new P("underscore",E.token,"_"),xor:new P("xor",E.token,"^"),plus_equal:new P("plus_equal",E.token,"+="),minus_equal:new P("minus_equal",E.token,"-="),times_equal:new P("times_equal",E.token,"*="),division_equal:new P("division_equal",E.token,"/="),modulo_equal:new P("modulo_equal",E.token,"%="),and_equal:new P("and_equal",E.token,"&="),or_equal:new P("or_equal",E.token,"|="),xor_equal:new P("xor_equal",E.token,"^="),shift_right_equal:new P("shift_right_equal",E.token,">>="),shift_left_equal:new P("shift_left_equal",E.token,"<<=")};M.simpleTokens={"@":R.tokens.attr,"{":R.tokens.brace_left,"}":R.tokens.brace_right,":":R.tokens.colon,",":R.tokens.comma,"(":R.tokens.paren_left,")":R.tokens.paren_right,";":R.tokens.semicolon};M.literalTokens={"&":R.tokens.and,"&&":R.tokens.and_and,"->":R.tokens.arrow,"/":R.tokens.forward_slash,"!":R.tokens.bang,"[":R.tokens.bracket_left,"]":R.tokens.bracket_right,"=":R.tokens.equal,"==":R.tokens.equal_equal,"!=":R.tokens.not_equal,">":R.tokens.greater_than,">=":R.tokens.greater_than_equal,">>":R.tokens.shift_right,"<":R.tokens.less_than,"<=":R.tokens.less_than_equal,"<<":R.tokens.shift_left,"%":R.tokens.modulo,"-":R.tokens.minus,"--":R.tokens.minus_minus,".":R.tokens.period,"+":R.tokens.plus,"++":R.tokens.plus_plus,"|":R.tokens.or,"||":R.tokens.or_or,"*":R.tokens.star,"~":R.tokens.tilde,_:R.tokens.underscore,"^":R.tokens.xor,"+=":R.tokens.plus_equal,"-=":R.tokens.minus_equal,"*=":R.tokens.times_equal,"/=":R.tokens.division_equal,"%=":R.tokens.modulo_equal,"&=":R.tokens.and_equal,"|=":R.tokens.or_equal,"^=":R.tokens.xor_equal,">>=":R.tokens.shift_right_equal,"<<=":R.tokens.shift_left_equal};M.regexTokens={decimal_float_literal:R.tokens.decimal_float_literal,hex_float_literal:R.tokens.hex_float_literal,int_literal:R.tokens.int_literal,uint_literal:R.tokens.uint_literal,ident:R.tokens.ident};M.storage_class=[R.keywords.function,R.keywords.private,R.keywords.workgroup,R.keywords.uniform,R.keywords.storage];M.access_mode=[R.keywords.read,R.keywords.write,R.keywords.read_write];M.sampler_type=[R.keywords.sampler,R.keywords.sampler_comparison];M.sampled_texture_type=[R.keywords.texture_1d,R.keywords.texture_2d,R.keywords.texture_2d_array,R.keywords.texture_3d,R.keywords.texture_cube,R.keywords.texture_cube_array];M.multisampled_texture_type=[R.keywords.texture_multisampled_2d];M.storage_texture_type=[R.keywords.texture_storage_1d,R.keywords.texture_storage_2d,R.keywords.texture_storage_2d_array,R.keywords.texture_storage_3d];M.depth_texture_type=[R.keywords.texture_depth_2d,R.keywords.texture_depth_2d_array,R.keywords.texture_depth_cube,R.keywords.texture_depth_cube_array,R.keywords.texture_depth_multisampled_2d];M.texture_external_type=[R.keywords.texture_external];M.any_texture_type=[...R.sampled_texture_type,...R.multisampled_texture_type,...R.storage_texture_type,...R.depth_texture_type,...R.texture_external_type];M.texel_format=[R.keywords.r8unorm,R.keywords.r8snorm,R.keywords.r8uint,R.keywords.r8sint,R.keywords.r16uint,R.keywords.r16sint,R.keywords.r16float,R.keywords.rg8unorm,R.keywords.rg8snorm,R.keywords.rg8uint,R.keywords.rg8sint,R.keywords.r32uint,R.keywords.r32sint,R.keywords.r32float,R.keywords.rg16uint,R.keywords.rg16sint,R.keywords.rg16float,R.keywords.rgba8unorm,R.keywords.rgba8unorm_srgb,R.keywords.rgba8snorm,R.keywords.rgba8uint,R.keywords.rgba8sint,R.keywords.bgra8unorm,R.keywords.bgra8unorm_srgb,R.keywords.rgb10a2unorm,R.keywords.rg11b10float,R.keywords.rg32uint,R.keywords.rg32sint,R.keywords.rg32float,R.keywords.rgba16uint,R.keywords.rgba16sint,R.keywords.rgba16float,R.keywords.rgba32uint,R.keywords.rgba32sint,R.keywords.rgba32float];M.const_literal=[R.tokens.int_literal,R.tokens.uint_literal,R.tokens.decimal_float_literal,R.tokens.hex_float_literal,R.keywords.true,R.keywords.false];M.literal_or_ident=[R.tokens.ident,R.tokens.int_literal,R.tokens.uint_literal,R.tokens.decimal_float_literal,R.tokens.hex_float_literal];M.element_count_expression=[R.tokens.int_literal,R.tokens.uint_literal,R.tokens.ident];M.template_types=[R.keywords.vec2,R.keywords.vec3,R.keywords.vec4,R.keywords.mat2x2,R.keywords.mat2x3,R.keywords.mat2x4,R.keywords.mat3x2,R.keywords.mat3x3,R.keywords.mat3x4,R.keywords.mat4x2,R.keywords.mat4x3,R.keywords.mat4x4,R.keywords.atomic,R.keywords.bitcast,...R.any_texture_type];M.attribute_name=[R.tokens.ident,R.keywords.block,R.keywords.diagnostic];M.assignment_operators=[R.tokens.equal,R.tokens.plus_equal,R.tokens.minus_equal,R.tokens.times_equal,R.tokens.division_equal,R.tokens.modulo_equal,R.tokens.and_equal,R.tokens.or_equal,R.tokens.xor_equal,R.tokens.shift_right_equal,R.tokens.shift_left_equal];M.increment_operators=[R.tokens.plus_plus,R.tokens.minus_minus];class FJ{constructor(_,J,G){this.type=_,this.lexeme=J,this.line=G}toString(){return this.lexeme}isTemplateType(){return M.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==M.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class hU{constructor(_){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=_!==null&&_!==void 0?_:""}scanTokens(){while(!this._isAtEnd())if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new FJ(M.eof,"",this._line)),this._tokens}scanToken(){let _=this._advance();if(_==`
`)return this._line++,!0;if(this._isWhitespace(_))return!0;if(_=="/"){if(this._peekAhead()=="/"){while(_!=`
`){if(this._isAtEnd())return!0;_=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let L=1;while(L>0){if(this._isAtEnd())return!0;if(_=this._advance(),_==`
`)this._line++;else if(_=="*"){if(this._peekAhead()=="/"){if(this._advance(),L--,L==0)return!0}}else if(_=="/"){if(this._peekAhead()=="*")this._advance(),L++}}return!0}}let J=M.simpleTokens[_];if(J)return this._addToken(J),!0;let G=M.none,$=this._isAlpha(_),T=_==="_";if(this._isAlphaNumeric(_)){let L=this._peekAhead();while(this._isAlphaNumeric(L))_+=this._advance(),L=this._peekAhead()}if($){let L=M.keywords[_];if(L)return this._addToken(L),!0}if($||T)return this._addToken(M.tokens.ident),!0;for(;;){let L=this._findType(_),I=this._peekAhead();if(_=="-"&&this._tokens.length>0){if(I=="=")return this._current++,_+=I,this._addToken(M.tokens.minus_equal),!0;if(I=="-")return this._current++,_+=I,this._addToken(M.tokens.minus_minus),!0;let z=this._tokens.length-1;if((M.literal_or_ident.indexOf(this._tokens[z].type)!=-1||this._tokens[z].type==M.tokens.paren_right)&&I!=">")return this._addToken(L),!0}if(_==">"&&(I==">"||I=="=")){let z=!1,l=this._tokens.length-1;for(let x=0;x<5&&l>=0;++x,--l){if(M.assignment_operators.indexOf(this._tokens[l].type)!==-1)break;if(this._tokens[l].type===M.tokens.less_than){if(l>0&&this._tokens[l-1].isArrayOrTemplateType())z=!0;break}}if(z)return this._addToken(L),!0}if(L===M.none){let z=_,l=0,x=2;for(let b=0;b<x;++b)if(z+=this._peekAhead(b),L=this._findType(z),L!==M.none){l=b;break}if(L===M.none){if(G===M.none)return!1;return this._current--,this._addToken(G),!0}_=z,this._current+=l+1}if(G=L,this._isAtEnd())break;_+=this._advance()}if(G===M.none)return!1;return this._addToken(G),!0}_findType(_){for(let G in M.regexTokens){let $=M.regexTokens[G];if(this._match(_,$.rule))return $}let J=M.literalTokens[_];if(J)return J;return M.none}_match(_,J){let G=J.exec(_);return G&&G.index==0&&G[0]==_}_isAtEnd(){return this._current>=this._source.length}_isAlpha(_){return _>="a"&&_<="z"||_>="A"&&_<="Z"}_isAlphaNumeric(_){return _>="a"&&_<="z"||_>="A"&&_<="Z"||_=="_"||_>="0"&&_<="9"}_isWhitespace(_){return _==" "||_=="\t"||_=="\r"}_advance(_=0){let J=this._source[this._current];return _=_||0,_++,this._current+=_,J}_peekAhead(_=0){if(_=_||0,this._current+_>=this._source.length)return"\x00";return this._source[this._current+_]}_addToken(_){let J=this._source.substring(this._start,this._current);this._tokens.push(new FJ(_,J,this._line))}}class NU{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new iJ,this._deferArrayCountEval=[]}parse(_){this._initialize(_),this._deferArrayCountEval.length=0;let J=[];while(!this._isAtEnd()){let G=this._global_decl_or_directive();if(!G)break;J.push(G)}if(this._deferArrayCountEval.length>0){for(let G of this._deferArrayCountEval){let{arrayType:$,countNode:T}=G;if(T instanceof y_){let I=T.name,z=this._context.constants.get(I);if(z)try{let l=z.evaluate(this._context);$.count=l}catch(l){}}}this._deferArrayCountEval.length=0}return J}_initialize(_){if(_)if(typeof _=="string"){let J=new hU(_);this._tokens=J.scanTokens()}else this._tokens=_;else this._tokens=[];this._current=0}_error(_,J){return{token:_,message:J,toString:function(){return`${J}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==M.eof}_match(_){if(_ instanceof P){if(this._check(_))return this._advance(),!0;return!1}for(let J=0,G=_.length;J<G;++J){let $=_[J];if(this._check($))return this._advance(),!0}return!1}_consume(_,J){if(this._check(_))return this._advance();throw this._error(this._peek(),J)}_check(_){if(this._isAtEnd())return!1;let J=this._peek();if(_ instanceof Array){let G=J.type;return _.indexOf(G)!=-1}return J.type==_}_advance(){var _,J;if(this._currentLine=(J=(_=this._peek())===null||_===void 0?void 0:_.line)!==null&&J!==void 0?J:-1,!this._isAtEnd())this._current++;return this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){while(this._match(M.tokens.semicolon)&&!this._isAtEnd());if(this._match(M.keywords.alias)){let J=this._type_alias();return this._consume(M.tokens.semicolon,"Expected ';'"),J}if(this._match(M.keywords.diagnostic)){let J=this._diagnostic();return this._consume(M.tokens.semicolon,"Expected ';'"),J}if(this._match(M.keywords.requires)){let J=this._requires_directive();return this._consume(M.tokens.semicolon,"Expected ';'"),J}if(this._match(M.keywords.enable)){let J=this._enable_directive();return this._consume(M.tokens.semicolon,"Expected ';'"),J}let _=this._attribute();if(this._check(M.keywords.var)){let J=this._global_variable_decl();if(J!=null)J.attributes=_;return this._consume(M.tokens.semicolon,"Expected ';'."),J}if(this._check(M.keywords.override)){let J=this._override_variable_decl();if(J!=null)J.attributes=_;return this._consume(M.tokens.semicolon,"Expected ';'."),J}if(this._check(M.keywords.let)){let J=this._global_let_decl();if(J!=null)J.attributes=_;return this._consume(M.tokens.semicolon,"Expected ';'."),J}if(this._check(M.keywords.const)){let J=this._global_const_decl();if(J!=null)J.attributes=_;return this._consume(M.tokens.semicolon,"Expected ';'."),J}if(this._check(M.keywords.struct)){let J=this._struct_decl();if(J!=null)J.attributes=_;return J}if(this._check(M.keywords.fn)){let J=this._function_decl();if(J!=null)J.attributes=_;return J}return null}_function_decl(){if(!this._match(M.keywords.fn))return null;let _=this._currentLine,J=this._consume(M.tokens.ident,"Expected function name.").toString();this._consume(M.tokens.paren_left,"Expected '(' for function arguments.");let G=[];if(!this._check(M.tokens.paren_right))do{if(this._check(M.tokens.paren_right))break;let I=this._attribute(),z=this._consume(M.tokens.ident,"Expected argument name.").toString();this._consume(M.tokens.colon,"Expected ':' for argument type.");let l=this._attribute(),x=this._type_decl();if(x!=null)x.attributes=l,G.push(new HU(z,x,I))}while(this._match(M.tokens.comma));this._consume(M.tokens.paren_right,"Expected ')' after function arguments.");let $=null;if(this._match(M.tokens.arrow)){let I=this._attribute();if($=this._type_decl(),$!=null)$.attributes=I}let T=this._compound_statement(),L=this._currentLine;return new c_(J,G,$,T,_,L)}_compound_statement(){let _=[];this._consume(M.tokens.brace_left,"Expected '{' for block.");while(!this._check(M.tokens.brace_right)){let J=this._statement();if(J!==null)_.push(J)}return this._consume(M.tokens.brace_right,"Expected '}' for block."),_}_statement(){while(this._match(M.tokens.semicolon)&&!this._isAtEnd());if(this._check(M.tokens.attr))this._attribute();if(this._check(M.keywords.if))return this._if_statement();if(this._check(M.keywords.switch))return this._switch_statement();if(this._check(M.keywords.loop))return this._loop_statement();if(this._check(M.keywords.for))return this._for_statement();if(this._check(M.keywords.while))return this._while_statement();if(this._check(M.keywords.continuing))return this._continuing_statement();if(this._check(M.keywords.static_assert))return this._static_assert_statement();if(this._check(M.tokens.brace_left))return this._compound_statement();let _=null;if(this._check(M.keywords.return))_=this._return_statement();else if(this._check([M.keywords.var,M.keywords.let,M.keywords.const]))_=this._variable_statement();else if(this._match(M.keywords.discard))_=new GU;else if(this._match(M.keywords.break))_=new QU;else if(this._match(M.keywords.continue))_=new XU;else _=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();if(_!=null)this._consume(M.tokens.semicolon,"Expected ';' after statement.");return _}_static_assert_statement(){if(!this._match(M.keywords.static_assert))return null;let _=this._optional_paren_expression();return new DJ(_)}_while_statement(){if(!this._match(M.keywords.while))return null;let _=this._optional_paren_expression();if(this._check(M.tokens.attr))this._attribute();let J=this._compound_statement();return new wJ(_,J)}_continuing_statement(){if(!this._match(M.keywords.continuing))return null;let _=this._compound_statement();return new mJ(_)}_for_statement(){if(!this._match(M.keywords.for))return null;this._consume(M.tokens.paren_left,"Expected '('.");let _=!this._check(M.tokens.semicolon)?this._for_init():null;this._consume(M.tokens.semicolon,"Expected ';'.");let J=!this._check(M.tokens.semicolon)?this._short_circuit_or_expression():null;this._consume(M.tokens.semicolon,"Expected ';'.");let G=!this._check(M.tokens.paren_right)?this._for_increment():null;if(this._consume(M.tokens.paren_right,"Expected ')'."),this._check(M.tokens.attr))this._attribute();let $=this._compound_statement();return new aJ(_,J,G,$)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(M.keywords.var)){let _=this._variable_decl();if(_===null)throw this._error(this._peek(),"Variable declaration expected.");let J=null;if(this._match(M.tokens.equal))J=this._short_circuit_or_expression();return new s0(_.name,_.type,_.storage,_.access,J)}if(this._match(M.keywords.let)){let _=this._consume(M.tokens.ident,"Expected name for let.").toString(),J=null;if(this._match(M.tokens.colon)){let $=this._attribute();if(J=this._type_decl(),J!=null)J.attributes=$}this._consume(M.tokens.equal,"Expected '=' for let.");let G=this._short_circuit_or_expression();return new x_(_,J,null,null,G)}if(this._match(M.keywords.const)){let _=this._consume(M.tokens.ident,"Expected name for const.").toString(),J=null;if(this._match(M.tokens.colon)){let $=this._attribute();if(J=this._type_decl(),J!=null)J.attributes=$}this._consume(M.tokens.equal,"Expected '=' for const.");let G=this._short_circuit_or_expression();return new _J(_,J,null,null,G)}return null}_increment_decrement_statement(){let _=this._current,J=this._unary_expression();if(J==null)return null;if(!this._check(M.increment_operators))return this._current=_,null;let G=this._consume(M.increment_operators,"Expected increment operator");return new nJ(G.type===M.tokens.plus_plus?G_.increment:G_.decrement,J)}_assignment_statement(){let _=null;if(this._check(M.tokens.brace_right))return null;let J=this._match(M.tokens.underscore);if(!J)_=this._unary_expression();if(!J&&_==null)return null;let G=this._consume(M.assignment_operators,"Expected assignment operator."),$=this._short_circuit_or_expression();return new eJ(O_.parse(G.lexeme),_,$)}_func_call_statement(){if(!this._check(M.tokens.ident))return null;let _=this._current,J=this._consume(M.tokens.ident,"Expected function name."),G=this._argument_expression_list();if(G===null)return this._current=_,null;return new WJ(J.lexeme,G)}_loop_statement(){if(!this._match(M.keywords.loop))return null;if(this._check(M.tokens.attr))this._attribute();this._consume(M.tokens.brace_left,"Expected '{' for loop.");let _=[],J=this._statement();while(J!==null){if(Array.isArray(J))for(let $ of J)_.push($);else _.push(J);J=this._statement()}let G=null;if(this._match(M.keywords.continuing))G=this._compound_statement();return this._consume(M.tokens.brace_right,"Expected '}' for loop."),new tJ(_,G)}_switch_statement(){if(!this._match(M.keywords.switch))return null;let _=this._optional_paren_expression();if(this._check(M.tokens.attr))this._attribute();this._consume(M.tokens.brace_left,"Expected '{' for switch.");let J=this._switch_body();if(J==null||J.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(M.tokens.brace_right,"Expected '}' for switch."),new sJ(_,J)}_switch_body(){let _=[];if(this._match(M.keywords.case)){let J=this._case_selectors();if(this._match(M.tokens.colon),this._check(M.tokens.attr))this._attribute();this._consume(M.tokens.brace_left,"Exected '{' for switch case.");let G=this._case_body();this._consume(M.tokens.brace_right,"Exected '}' for switch case."),_.push(new MU(J,G))}if(this._match(M.keywords.default)){if(this._match(M.tokens.colon),this._check(M.tokens.attr))this._attribute();this._consume(M.tokens.brace_left,"Exected '{' for switch default.");let J=this._case_body();this._consume(M.tokens.brace_right,"Exected '}' for switch default."),_.push(new VU(J))}if(this._check([M.keywords.default,M.keywords.case])){let J=this._switch_body();_.push(J[0])}return _}_case_selectors(){let _=[this._shift_expression()];while(this._match(M.tokens.comma))_.push(this._shift_expression());return _}_case_body(){if(this._match(M.keywords.fallthrough))return this._consume(M.tokens.semicolon,"Expected ';'"),[];let _=this._statement();if(_==null)return[];if(!(_ instanceof Array))_=[_];let J=this._case_body();if(J.length==0)return _;return[..._,J[0]]}_if_statement(){if(!this._match(M.keywords.if))return null;let _=this._optional_paren_expression();if(this._check(M.tokens.attr))this._attribute();let J=this._compound_statement(),G=[];if(this._match_elseif()){if(this._check(M.tokens.attr))this._attribute();G=this._elseif_statement(G)}let $=null;if(this._match(M.keywords.else)){if(this._check(M.tokens.attr))this._attribute();$=this._compound_statement()}return new _U(_,J,G,$)}_match_elseif(){if(this._tokens[this._current].type===M.keywords.else&&this._tokens[this._current+1].type===M.keywords.if)return this._advance(),this._advance(),!0;return!1}_elseif_statement(_=[]){let J=this._optional_paren_expression(),G=this._compound_statement();if(_.push(new jU(J,G)),this._match_elseif()){if(this._check(M.tokens.attr))this._attribute();this._elseif_statement(_)}return _}_return_statement(){if(!this._match(M.keywords.return))return null;let _=this._short_circuit_or_expression();return new JU(_)}_short_circuit_or_expression(){let _=this._short_circuit_and_expr();while(this._match(M.tokens.or_or))_=new D0(this._previous().toString(),_,this._short_circuit_and_expr());return _}_short_circuit_and_expr(){let _=this._inclusive_or_expression();while(this._match(M.tokens.and_and))_=new D0(this._previous().toString(),_,this._inclusive_or_expression());return _}_inclusive_or_expression(){let _=this._exclusive_or_expression();while(this._match(M.tokens.or))_=new D0(this._previous().toString(),_,this._exclusive_or_expression());return _}_exclusive_or_expression(){let _=this._and_expression();while(this._match(M.tokens.xor))_=new D0(this._previous().toString(),_,this._and_expression());return _}_and_expression(){let _=this._equality_expression();while(this._match(M.tokens.and))_=new D0(this._previous().toString(),_,this._equality_expression());return _}_equality_expression(){let _=this._relational_expression();if(this._match([M.tokens.equal_equal,M.tokens.not_equal]))return new D0(this._previous().toString(),_,this._relational_expression());return _}_relational_expression(){let _=this._shift_expression();while(this._match([M.tokens.less_than,M.tokens.greater_than,M.tokens.less_than_equal,M.tokens.greater_than_equal]))_=new D0(this._previous().toString(),_,this._shift_expression());return _}_shift_expression(){let _=this._additive_expression();while(this._match([M.tokens.shift_left,M.tokens.shift_right]))_=new D0(this._previous().toString(),_,this._additive_expression());return _}_additive_expression(){let _=this._multiplicative_expression();while(this._match([M.tokens.plus,M.tokens.minus]))_=new D0(this._previous().toString(),_,this._multiplicative_expression());return _}_multiplicative_expression(){let _=this._unary_expression();while(this._match([M.tokens.star,M.tokens.forward_slash,M.tokens.modulo]))_=new D0(this._previous().toString(),_,this._unary_expression());return _}_unary_expression(){if(this._match([M.tokens.minus,M.tokens.bang,M.tokens.tilde,M.tokens.star,M.tokens.and]))return new WU(this._previous().toString(),this._unary_expression());return this._singular_expression()}_singular_expression(){let _=this._primary_expression(),J=this._postfix_expression();if(J)_.postfix=J;return _}_postfix_expression(){if(this._match(M.tokens.bracket_left)){let _=this._short_circuit_or_expression();this._consume(M.tokens.bracket_right,"Expected ']'.");let J=new BU(_),G=this._postfix_expression();if(G)J.postfix=G;return J}if(this._match(M.tokens.period)){let _=this._consume(M.tokens.ident,"Expected member name."),J=this._postfix_expression(),G=new YU(_.lexeme);if(J)G.postfix=J;return G}return null}_getStruct(_){if(this._context.aliases.has(_))return this._context.aliases.get(_).type;if(this._context.structs.has(_))return this._context.structs.get(_);return null}_primary_expression(){if(this._match(M.tokens.ident)){let G=this._previous().toString();if(this._check(M.tokens.paren_left)){let $=this._argument_expression_list(),T=this._getStruct(G);if(T!=null)return new J_(T,$);return new jJ(G,$)}if(this._context.constants.has(G)){let $=this._context.constants.get(G);return new JJ(G,$.value)}return new y_(G)}if(this._match(M.const_literal))return new UJ(parseFloat(this._previous().toString()));if(this._check(M.tokens.paren_left))return this._paren_expression();if(this._match(M.keywords.bitcast)){this._consume(M.tokens.less_than,"Expected '<'.");let G=this._type_decl();this._consume(M.tokens.greater_than,"Expected '>'.");let $=this._paren_expression();return new $U(G,$)}let _=this._type_decl(),J=this._argument_expression_list();return new J_(_,J)}_argument_expression_list(){if(!this._match(M.tokens.paren_left))return null;let _=[];do{if(this._check(M.tokens.paren_right))break;let J=this._short_circuit_or_expression();_.push(J)}while(this._match(M.tokens.comma));return this._consume(M.tokens.paren_right,"Expected ')' for agument list"),_}_optional_paren_expression(){this._match(M.tokens.paren_left);let _=this._short_circuit_or_expression();return this._match(M.tokens.paren_right),new KJ([_])}_paren_expression(){this._consume(M.tokens.paren_left,"Expected '('.");let _=this._short_circuit_or_expression();return this._consume(M.tokens.paren_right,"Expected ')'."),new KJ([_])}_struct_decl(){if(!this._match(M.keywords.struct))return null;let _=this._currentLine,J=this._consume(M.tokens.ident,"Expected name for struct.").toString();this._consume(M.tokens.brace_left,"Expected '{' for struct body.");let G=[];while(!this._check(M.tokens.brace_right)){let L=this._attribute(),I=this._consume(M.tokens.ident,"Expected variable name.").toString();this._consume(M.tokens.colon,"Expected ':' for struct member type.");let z=this._attribute(),l=this._type_decl();if(l!=null)l.attributes=z;if(!this._check(M.tokens.brace_right))this._consume(M.tokens.comma,"Expected ',' for struct member.");else this._match(M.tokens.comma);G.push(new TU(I,l,L))}this._consume(M.tokens.brace_right,"Expected '}' after struct body.");let $=this._currentLine,T=new t0(J,G,_,$);return this._context.structs.set(J,T),T}_global_variable_decl(){let _=this._variable_decl();if(_&&this._match(M.tokens.equal))_.value=this._const_expression();return _}_override_variable_decl(){let _=this._override_decl();if(_&&this._match(M.tokens.equal))_.value=this._const_expression();return _}_global_const_decl(){if(!this._match(M.keywords.const))return null;let _=this._consume(M.tokens.ident,"Expected variable name"),J=null;if(this._match(M.tokens.colon)){let T=this._attribute();if(J=this._type_decl(),J!=null)J.attributes=T}let G=null;if(this._match(M.tokens.equal)){let T=this._short_circuit_or_expression();if(T instanceof J_)G=T;else if(T instanceof JJ&&T.initializer instanceof J_)G=T.initializer;else try{let L=T.evaluate(this._context);G=new UJ(L)}catch(L){G=T}}let $=new _J(_.toString(),J,"","",G);return this._context.constants.set($.name,$),$}_global_let_decl(){if(!this._match(M.keywords.let))return null;let _=this._consume(M.tokens.ident,"Expected variable name"),J=null;if(this._match(M.tokens.colon)){let $=this._attribute();if(J=this._type_decl(),J!=null)J.attributes=$}let G=null;if(this._match(M.tokens.equal))G=this._const_expression();return new x_(_.toString(),J,"","",G)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(M.keywords.var))return null;let _="",J="";if(this._match(M.tokens.less_than)){if(_=this._consume(M.storage_class,"Expected storage_class.").toString(),this._match(M.tokens.comma))J=this._consume(M.access_mode,"Expected access_mode.").toString();this._consume(M.tokens.greater_than,"Expected '>'.")}let G=this._consume(M.tokens.ident,"Expected variable name"),$=null;if(this._match(M.tokens.colon)){let T=this._attribute();if($=this._type_decl(),$!=null)$.attributes=T}return new s0(G.toString(),$,_,J,null)}_override_decl(){if(!this._match(M.keywords.override))return null;let _=this._consume(M.tokens.ident,"Expected variable name"),J=null;if(this._match(M.tokens.colon)){let G=this._attribute();if(J=this._type_decl(),J!=null)J.attributes=G}return new BJ(_.toString(),J,null)}_diagnostic(){this._consume(M.tokens.paren_left,"Expected '('");let _=this._consume(M.tokens.ident,"Expected severity control name.");this._consume(M.tokens.comma,"Expected ','");let J=this._consume(M.tokens.ident,"Expected diagnostic rule name.");return this._consume(M.tokens.paren_right,"Expected ')'"),new FU(_.toString(),J.toString())}_enable_directive(){let _=this._consume(M.tokens.ident,"identity expected.");return new UU(_.toString())}_requires_directive(){let _=[this._consume(M.tokens.ident,"identity expected.").toString()];while(this._match(M.tokens.comma)){let J=this._consume(M.tokens.ident,"identity expected.");_.push(J.toString())}return new KU(_)}_type_alias(){let _=this._consume(M.tokens.ident,"identity expected.");this._consume(M.tokens.equal,"Expected '=' for type alias.");let J=this._type_decl();if(J===null)throw this._error(this._peek(),"Expected Type for Alias.");if(this._context.aliases.has(J.name))J=this._context.aliases.get(J.name).type;let G=new MJ(_.toString(),J);return this._context.aliases.set(G.name,G),G}_type_decl(){if(this._check([M.tokens.ident,...M.texel_format,M.keywords.bool,M.keywords.f32,M.keywords.i32,M.keywords.u32])){let G=this._advance(),$=G.toString();if(this._context.structs.has($))return this._context.structs.get($);if(this._context.aliases.has($))return this._context.aliases.get($).type;return new __(G.toString())}let _=this._texture_sampler_types();if(_)return _;if(this._check(M.template_types)){let G=this._advance().toString(),$=null,T=null;if(this._match(M.tokens.less_than)){if($=this._type_decl(),T=null,this._match(M.tokens.comma))T=this._consume(M.access_mode,"Expected access_mode for pointer").toString();this._consume(M.tokens.greater_than,"Expected '>' for type.")}return new VJ(G,$,T)}if(this._match(M.keywords.ptr)){let G=this._previous().toString();this._consume(M.tokens.less_than,"Expected '<' for pointer.");let $=this._consume(M.storage_class,"Expected storage_class for pointer");this._consume(M.tokens.comma,"Expected ',' for pointer.");let T=this._type_decl(),L=null;if(this._match(M.tokens.comma))L=this._consume(M.access_mode,"Expected access_mode for pointer").toString();return this._consume(M.tokens.greater_than,"Expected '>' for pointer."),new ZU(G,$.toString(),T,L)}let J=this._attribute();if(this._match(M.keywords.array)){let G=null,$=-1,T=this._previous(),L=null;if(this._match(M.tokens.less_than)){if(G=this._type_decl(),this._context.aliases.has(G.name))G=this._context.aliases.get(G.name).type;let z="";if(this._match(M.tokens.comma)){L=this._shift_expression();try{z=L.evaluate(this._context).toString(),L=null}catch(l){z="1"}}this._consume(M.tokens.greater_than,"Expected '>' for array."),$=z?parseInt(z):0}let I=new HJ(T.toString(),J,G,$);if(L)this._deferArrayCountEval.push({arrayType:I,countNode:L});return I}return null}_texture_sampler_types(){if(this._match(M.sampler_type))return new F_(this._previous().toString(),null,null);if(this._match(M.depth_texture_type))return new F_(this._previous().toString(),null,null);if(this._match(M.sampled_texture_type)||this._match(M.multisampled_texture_type)){let _=this._previous();this._consume(M.tokens.less_than,"Expected '<' for sampler type.");let J=this._type_decl();return this._consume(M.tokens.greater_than,"Expected '>' for sampler type."),new F_(_.toString(),J,null)}if(this._match(M.storage_texture_type)){let _=this._previous();this._consume(M.tokens.less_than,"Expected '<' for sampler type.");let J=this._consume(M.texel_format,"Invalid texel format.").toString();this._consume(M.tokens.comma,"Expected ',' after texel format.");let G=this._consume(M.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(M.tokens.greater_than,"Expected '>' for sampler type."),new F_(_.toString(),J,G)}return null}_attribute(){let _=[];while(this._match(M.tokens.attr)){let J=this._consume(M.attribute_name,"Expected attribute name"),G=new OU(J.toString(),null);if(this._match(M.tokens.paren_left)){if(G.value=this._consume(M.literal_or_ident,"Expected attribute value").toString(),this._check(M.tokens.comma)){this._advance();do{let $=this._consume(M.literal_or_ident,"Expected attribute value").toString();if(!(G.value instanceof Array))G.value=[G.value];G.value.push($)}while(this._match(M.tokens.comma))}this._consume(M.tokens.paren_right,"Expected ')'")}_.push(G)}if(_.length==0)return null;return _}}class U_{constructor(_,J){this.name=_,this.attributes=J,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class GJ{constructor(_,J,G){this.name=_,this.type=J,this.attributes=G,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class M_ extends U_{constructor(_,J){super(_,J);this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class u_ extends U_{constructor(_,J){super(_,J);this.count=0,this.stride=0}get isArray(){return!0}}class QJ extends U_{constructor(_,J,G,$){super(_,G);this.format=J,this.access=$}get isTemplate(){return!0}}var Q0;(function(_){_[_.Uniform=0]="Uniform",_[_.Storage=1]="Storage",_[_.Texture=2]="Texture",_[_.Sampler=3]="Sampler",_[_.StorageTexture=4]="StorageTexture"})(Q0||(Q0={}));class V_{constructor(_,J,G,$,T,L,I){this.name=_,this.type=J,this.group=G,this.binding=$,this.attributes=T,this.resourceType=L,this.access=I}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class LU{constructor(_,J){this.name=_,this.type=J}}class H_{constructor(_,J){this.align=_,this.size=J}}class kU{constructor(_,J,G,$){this.name=_,this.type=J,this.locationType=G,this.location=$,this.interpolation=null}}class XJ{constructor(_,J,G,$){this.name=_,this.type=J,this.locationType=G,this.location=$}}class EU{constructor(_,J,G,$){this.name=_,this.type=J,this.attributes=G,this.id=$}}class PU{constructor(_,J){this.name=_,this.type=J}}class RU{constructor(_,J=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=_,this.stage=J}}class qU{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class SU{constructor(_){this.resources=null,this.inUse=!1,this.info=null,this.node=_}}class n0{constructor(_){if(this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new qU,this.functions=[],this._types=new Map,this._functions=new Map,_)this.update(_)}_isStorageTexture(_){return _.name=="texture_storage_1d"||_.name=="texture_storage_2d"||_.name=="texture_storage_2d_array"||_.name=="texture_storage_3d"}update(_){let G=new NU().parse(_);for(let $ of G)if($ instanceof c_)this._functions.set($.name,new SU($));for(let $ of G)if($ instanceof t0){let T=this._getTypeInfo($,null);if(T instanceof M_)this.structs.push(T)}for(let $ of G){if($ instanceof MJ){this.aliases.push(this._getAliasInfo($));continue}if($ instanceof BJ){let T=$,L=this._getAttributeNum(T.attributes,"id",0),I=T.type!=null?this._getTypeInfo(T.type,T.attributes):null;this.overrides.push(new EU(T.name,I,T.attributes,L));continue}if(this._isUniformVar($)){let T=$,L=this._getAttributeNum(T.attributes,"group",0),I=this._getAttributeNum(T.attributes,"binding",0),z=this._getTypeInfo(T.type,T.attributes),l=new V_(T.name,z,L,I,T.attributes,Q0.Uniform,T.access);this.uniforms.push(l);continue}if(this._isStorageVar($)){let T=$,L=this._getAttributeNum(T.attributes,"group",0),I=this._getAttributeNum(T.attributes,"binding",0),z=this._getTypeInfo(T.type,T.attributes),l=this._isStorageTexture(z),x=new V_(T.name,z,L,I,T.attributes,l?Q0.StorageTexture:Q0.Storage,T.access);this.storage.push(x);continue}if(this._isTextureVar($)){let T=$,L=this._getAttributeNum(T.attributes,"group",0),I=this._getAttributeNum(T.attributes,"binding",0),z=this._getTypeInfo(T.type,T.attributes),l=this._isStorageTexture(z),x=new V_(T.name,z,L,I,T.attributes,l?Q0.StorageTexture:Q0.Texture,T.access);if(l)this.storage.push(x);else this.textures.push(x);continue}if(this._isSamplerVar($)){let T=$,L=this._getAttributeNum(T.attributes,"group",0),I=this._getAttributeNum(T.attributes,"binding",0),z=this._getTypeInfo(T.type,T.attributes),l=new V_(T.name,z,L,I,T.attributes,Q0.Sampler,T.access);this.samplers.push(l);continue}if($ instanceof c_){let T=this._getAttribute($,"vertex"),L=this._getAttribute($,"fragment"),I=this._getAttribute($,"compute"),z=T||L||I,l=new RU($.name,z===null||z===void 0?void 0:z.name);if(l.startLine=$.startLine,l.endLine=$.endLine,this.functions.push(l),this._functions.get($.name).info=l,z)this._functions.get($.name).inUse=!0,l.inUse=!0,l.resources=this._findResources($,!!z),l.inputs=this._getInputs($.args),l.outputs=this._getOutputs($.returnType),this.entry[z.name].push(l);l.arguments=$.args.map((x)=>new PU(x.name,this._getTypeInfo(x.type,x.attributes))),l.returnType=$.returnType?this._getTypeInfo($.returnType,$.attributes):null;continue}}for(let $ of this._functions.values())if($.info)$.info.inUse=$.inUse,this._addCalls($.node,$.info.calls);for(let $ of this._functions.values())$.node.search((T)=>{var L;if(T.astNodeType==="varExpr"){let I=T;for(let z of this.overrides)if(I.name==z.name)(L=$.info)===null||L===void 0||L.overrides.push(z)}});for(let $ of this.uniforms)this._markStructsInUse($.type);for(let $ of this.storage)this._markStructsInUse($.type)}_markStructsInUse(_){if(!_)return;if(_.isStruct){if(_.inUse=!0,_.members)for(let J of _.members)this._markStructsInUse(J.type)}else if(_.isArray)this._markStructsInUse(_.format);else if(_.isTemplate){if(_.format)this._markStructsInUse(_.format)}else{let J=this._getAlias(_.name);if(J)this._markStructsInUse(J)}}_addCalls(_,J){var G;for(let $ of _.calls){let T=(G=this._functions.get($.name))===null||G===void 0?void 0:G.info;if(T)J.add(T)}}findResource(_,J){for(let G of this.uniforms)if(G.group==_&&G.binding==J)return G;for(let G of this.storage)if(G.group==_&&G.binding==J)return G;for(let G of this.textures)if(G.group==_&&G.binding==J)return G;for(let G of this.samplers)if(G.group==_&&G.binding==J)return G;return null}_findResource(_){for(let J of this.uniforms)if(J.name==_)return J;for(let J of this.storage)if(J.name==_)return J;for(let J of this.textures)if(J.name==_)return J;for(let J of this.samplers)if(J.name==_)return J;return null}_markStructsFromAST(_){let J=this._getTypeInfo(_,null);this._markStructsInUse(J)}_findResources(_,J){let G=[],$=this,T=[];return _.search((L)=>{if(L instanceof j_)T.push({});else if(L instanceof T_)T.pop();else if(L instanceof s0){let I=L;if(J&&I.type!==null)this._markStructsFromAST(I.type);if(T.length>0)T[T.length-1][I.name]=I}else if(L instanceof J_){let I=L;if(J&&I.type!==null)this._markStructsFromAST(I.type)}else if(L instanceof x_){let I=L;if(J&&I.type!==null)this._markStructsFromAST(I.type);if(T.length>0)T[T.length-1][I.name]=I}else if(L instanceof y_){let I=L;if(T.length>0){if(T[T.length-1][I.name])return}let z=$._findResource(I.name);if(z)G.push(z)}else if(L instanceof jJ){let I=L,z=$._functions.get(I.name);if(z){if(J)z.inUse=!0;if(_.calls.add(z.node),z.resources===null)z.resources=$._findResources(z.node,J);G.push(...z.resources)}}else if(L instanceof WJ){let I=L,z=$._functions.get(I.name);if(z){if(J)z.inUse=!0;if(_.calls.add(z.node),z.resources===null)z.resources=$._findResources(z.node,J);G.push(...z.resources)}}}),[...new Map(G.map((L)=>[L.name,L])).values()]}getBindGroups(){let _=[];function J(G,$){if(G>=_.length)_.length=G+1;if(_[G]===void 0)_[G]=[];if($>=_[G].length)_[G].length=$+1}for(let G of this.uniforms){J(G.group,G.binding);let $=_[G.group];$[G.binding]=G}for(let G of this.storage){J(G.group,G.binding);let $=_[G.group];$[G.binding]=G}for(let G of this.textures){J(G.group,G.binding);let $=_[G.group];$[G.binding]=G}for(let G of this.samplers){J(G.group,G.binding);let $=_[G.group];$[G.binding]=G}return _}_getOutputs(_,J=void 0){if(J===void 0)J=[];if(_ instanceof t0)this._getStructOutputs(_,J);else{let G=this._getOutputInfo(_);if(G!==null)J.push(G)}return J}_getStructOutputs(_,J){for(let G of _.members)if(G.type instanceof t0)this._getStructOutputs(G.type,J);else{let $=this._getAttribute(G,"location")||this._getAttribute(G,"builtin");if($!==null){let T=this._getTypeInfo(G.type,G.type.attributes),L=this._parseInt($.value),I=new XJ(G.name,T,$.name,L);J.push(I)}}}_getOutputInfo(_){let J=this._getAttribute(_,"location")||this._getAttribute(_,"builtin");if(J!==null){let G=this._getTypeInfo(_,_.attributes),$=this._parseInt(J.value);return new XJ("",G,J.name,$)}return null}_getInputs(_,J=void 0){if(J===void 0)J=[];for(let G of _)if(G.type instanceof t0)this._getStructInputs(G.type,J);else{let $=this._getInputInfo(G);if($!==null)J.push($)}return J}_getStructInputs(_,J){for(let G of _.members)if(G.type instanceof t0)this._getStructInputs(G.type,J);else{let $=this._getInputInfo(G);if($!==null)J.push($)}}_getInputInfo(_){let J=this._getAttribute(_,"location")||this._getAttribute(_,"builtin");if(J!==null){let G=this._getAttribute(_,"interpolation"),$=this._getTypeInfo(_.type,_.attributes),T=this._parseInt(J.value),L=new kU(_.name,$,J.name,T);if(G!==null)L.interpolation=this._parseString(G.value);return L}return null}_parseString(_){if(_ instanceof Array)_=_[0];return _}_parseInt(_){if(_ instanceof Array)_=_[0];let J=parseInt(_);return isNaN(J)?_:J}_getAlias(_){for(let J of this.aliases)if(J.name==_)return J.type;return null}_getAliasInfo(_){return new LU(_.name,this._getTypeInfo(_.type,null))}_getTypeInfo(_,J){if(this._types.has(_))return this._types.get(_);if(_ instanceof HJ){let $=_,T=$.format?this._getTypeInfo($.format,$.attributes):null,L=new u_($.name,J);return L.format=T,L.count=$.count,this._types.set(_,L),this._updateTypeInfo(L),L}if(_ instanceof t0){let $=_,T=new M_($.name,J);T.startLine=$.startLine,T.endLine=$.endLine;for(let L of $.members){let I=this._getTypeInfo(L.type,L.attributes);T.members.push(new GJ(L.name,I,L.attributes))}return this._types.set(_,T),this._updateTypeInfo(T),T}if(_ instanceof F_){let $=_,T=$.format instanceof __,L=$.format?T?this._getTypeInfo($.format,null):new U_($.format,null):null,I=new QJ($.name,L,J,$.access);return this._types.set(_,I),this._updateTypeInfo(I),I}if(_ instanceof VJ){let $=_,T=$.format?this._getTypeInfo($.format,null):null,L=new QJ($.name,T,J,$.access);return this._types.set(_,L),this._updateTypeInfo(L),L}let G=new U_(_.name,J);return this._types.set(_,G),this._updateTypeInfo(G),G}_updateTypeInfo(_){var J,G;let $=this._getTypeSize(_);if(_.size=(J=$===null||$===void 0?void 0:$.size)!==null&&J!==void 0?J:0,_ instanceof u_){if(_.format){let T=this._getTypeSize(_.format);_.stride=(G=T===null||T===void 0?void 0:T.size)!==null&&G!==void 0?G:0,this._updateTypeInfo(_.format)}}if(_ instanceof M_)this._updateStructInfo(_)}_updateStructInfo(_){var J;let G=0,$=0,T=0,L=0;for(let I=0,z=_.members.length;I<z;++I){let l=_.members[I],x=this._getTypeSize(l);if(!x)continue;(J=this._getAlias(l.type.name))!==null&&J!==void 0||l.type;let{align:b,size:r}=x;G=this._roundUp(b,G+$),$=r,T=G,L=Math.max(L,b),l.offset=G,l.size=r,this._updateTypeInfo(l.type)}_.size=this._roundUp(L,T+$),_.align=L}_getTypeSize(_){var J,G;if(_===null||_===void 0)return null;let $=this._getAttributeNum(_.attributes,"size",0),T=this._getAttributeNum(_.attributes,"align",0);if(_ instanceof GJ)_=_.type;if(_ instanceof U_){let L=this._getAlias(_.name);if(L!==null)_=L}{let L=n0._typeInfo[_.name];if(L!==void 0){let I=((J=_.format)===null||J===void 0?void 0:J.name)==="f16"?2:1;return new H_(Math.max(T,L.align/I),Math.max($,L.size/I))}}{let L=n0._typeInfo[_.name.substring(0,_.name.length-1)];if(L){let I=_.name[_.name.length-1]==="h"?2:1;return new H_(Math.max(T,L.align/I),Math.max($,L.size/I))}}if(_ instanceof u_){let L=_,I=8,z=8,l=this._getTypeSize(L.format);if(l!==null)z=l.size,I=l.align;let x=L.count,b=this._getAttributeNum((G=_===null||_===void 0?void 0:_.attributes)!==null&&G!==void 0?G:null,"stride",this._roundUp(I,z));if(z=x*b,$)z=$;return new H_(Math.max(T,I),Math.max($,z))}if(_ instanceof M_){let L=0,I=0,z=0,l=0,x=0;for(let b of _.members){let r=this._getTypeSize(b.type);if(r!==null)L=Math.max(r.align,L),z=this._roundUp(r.align,z+l),l=r.size,x=z}return I=this._roundUp(L,x+l),new H_(Math.max(T,L),Math.max($,I))}return null}_isUniformVar(_){return _ instanceof s0&&_.storage=="uniform"}_isStorageVar(_){return _ instanceof s0&&_.storage=="storage"}_isTextureVar(_){return _ instanceof s0&&_.type!==null&&n0._textureTypes.indexOf(_.type.name)!=-1}_isSamplerVar(_){return _ instanceof s0&&_.type!==null&&n0._samplerTypes.indexOf(_.type.name)!=-1}_getAttribute(_,J){let G=_;if(!G||!G.attributes)return null;let $=G.attributes;for(let T of $)if(T.name==J)return T;return null}_getAttributeNum(_,J,G){if(_===null)return G;for(let $ of _)if($.name==J){let T=$!==null&&$.value!==null?$.value:G;if(T instanceof Array)T=T[0];if(typeof T==="number")return T;if(typeof T==="string")return parseInt(T);return G}return G}_roundUp(_,J){return Math.ceil(J/_)*_}}n0._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};n0._textureTypes=M.any_texture_type.map((_)=>{return _.name});n0._samplerTypes=M.sampler_type.map((_)=>{return _.name});function K_(_,J){return Object.fromEntries(J.map((G)=>{let $=XK(_,G,0);return[G.name,{typeDefinition:$,group:G.group,binding:G.binding,size:$.size}]}))}function IU(_,J,G){return{fields:Object.fromEntries(J.members.map((T)=>{return[T.name,{offset:T.offset,type:NJ(_,T.type,0)}]})),size:J.size,offset:G}}function KK(_){if(_.name.includes("depth"))return"depth";switch(_.format?.name){case"f32":return"float";case"i32":return"sint";case"u32":return"uint";default:throw new Error("unknown texture sample type")}}function dJ(_){if(_.name.includes("2d_array"))return"2d-array";if(_.name.includes("cube_array"))return"cube-array";if(_.name.includes("3d"))return"3d";if(_.name.includes("1d"))return"1d";if(_.name.includes("cube"))return"cube";return"2d"}function FK(_){switch(_.access){case"read":return"read-only";case"write":return"write-only";case"read_write":return"read-write";default:throw new Error("unknonw storage texture access")}}function GK(_){return _.name.endsWith("_comparison")?"comparison":"filtering"}function QK(_,J){let{binding:G,access:$,type:T}=_;switch(_.resourceType){case Q0.Uniform:return{binding:G,visibility:J,buffer:{..._.size&&{minBindingSize:_.size}}};case Q0.Storage:return{binding:G,visibility:J,buffer:{type:$===""||$==="read"?"read-only-storage":"storage",..._.size&&{minBindingSize:_.size}}};case Q0.Texture:{if(T.name==="texture_external")return{binding:G,visibility:J,externalTexture:{}};let L=T.name.includes("multisampled");return{binding:G,visibility:J,texture:{sampleType:KK(T),viewDimension:dJ(T),multisampled:L}}}case Q0.Sampler:return{binding:G,visibility:J,sampler:{type:GK(T)}};case Q0.StorageTexture:return{binding:G,visibility:J,storageTexture:{access:FK(T),format:T.format.name,viewDimension:dJ(T)}};default:throw new Error("unknown resource type")}}function n_(_,J){let G={};for(let $ of _)G[$.name]={stage:J,resources:$.resources.map((T)=>{let{name:L,group:I}=T;return{name:L,group:I,entry:QK(T,J)}})};return G}function hJ(_){let J=new n0(_),G=Object.fromEntries(J.structs.map((b)=>{return[b.name,IU(J,b,0)]})),$=K_(J,J.uniforms),T=K_(J,J.storage.filter((b)=>b.resourceType===Q0.Storage)),L=K_(J,J.storage.filter((b)=>b.resourceType===Q0.StorageTexture)),I=K_(J,J.textures.filter((b)=>b.type.name!=="texture_external")),z=K_(J,J.textures.filter((b)=>b.type.name==="texture_external")),l=K_(J,J.samplers),x={...n_(J.entry.vertex,GPUShaderStage.VERTEX),...n_(J.entry.fragment,GPUShaderStage.FRAGMENT),...n_(J.entry.compute,GPUShaderStage.COMPUTE)};return{externalTextures:z,samplers:l,structs:G,storages:T,storageTextures:L,textures:I,uniforms:$,entryPoints:x}}function e_(_,J=""){if(!_)throw new Error(J)}function XK(_,J,G){switch(J.resourceType){case Q0.Uniform:case Q0.Storage:case Q0.StorageTexture:return NJ(_,J.type,G);default:return{size:0,type:J.type.name}}}function NJ(_,J,G){if(J.isArray){e_(!J.isStruct,"struct array is invalid"),e_(!J.isStruct,"template array is invalid");let $=J;return{size:$.size,elementType:NJ(_,$.format,G),numElements:$.count}}else if(J.isStruct)return e_(!J.isTemplate,"template struct is invalid"),IU(_,J,G);else{let $=J,T=J.isTemplate?`${$.name}<${$.format.name}>`:J.name;return{size:J.size,type:T}}}var ZK=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]),yK=new Map([...ZK.entries()].map(([_,{formats:[J,G]}])=>[[J,_],[G,_]]).flat());function AU(_){return _.split("_").map((J)=>J.charAt(0).toUpperCase()+J.slice(1).toLowerCase()).join("")}function YK(_,J,G){return Math.max(Math.min(_,G),J)}class fU{view;uniform_view;time;delta_time;scale;constructor(_){this.view=_,this.time=0,this.delta_time=0,this.scale=1;let G=hJ(`
    struct RenderDescriptor {
      time: f32,
      delta_time: f32,
    
      view: mat4x4f,
      static_view: mat4x4f,

      scale: f32,
      viewport_size: vec2f,
    }
    
    @group(0) @binding(0) var<uniform> desc: RenderDescriptor;
    `),$=YJ(G.uniforms.desc);this.uniform_view=$}update(){let _=this.view.Camera,J=C_.ortho(0,_.ViewportSize.x,_.ViewportSize.y,0,_.Near,_.Far),G=Math.min(_.ViewportSize.y,_.ViewportSize.x),T=1/_.Resolution.y*YK(1/_.Resolution.x*_.ViewportSize.x/(1/_.Resolution.y*G),0,1)*G;this.scale=T,this.uniform_view.set({time:this.time,delta_time:this.delta_time,scale:T,viewport_size:_.ViewportSize.serialize()}),C_.translate(J,a_.fromValues(..._.Position.serialize()),this.uniform_view.views.view),C_.translate(J,a_.fromValues(0,0,_.Position.z),this.uniform_view.views.static_view)}}if(!navigator.gpu)throw new Error("WebGPU not supported in this browser");var gU=await navigator.gpu.requestAdapter();if(!gU)throw new Error("No appropriate GPUAdapter found");var R0=await gU.requestDevice();class p_{device;format;render_info;render_descriptor;render_descriptor_buffer;Camera;PreRender;PostRender;constructor(_){let J=_.getContext("webgpu");if(!J)throw new Error("WebGPU canvas context is unavailable");J.configure({device:R0,format:navigator.gpu.getPreferredCanvasFormat()}),this.device=R0,this.format=navigator.gpu.getPreferredCanvasFormat(),this.render_info=new Map,this.render_descriptor=new fU(this),this.Camera={Position:new D_(0,0,0),Resolution:new i0(1920,1080),ViewportSize:new i0,Near:1200,Far:-1000},this.PreRender=new W_,this.PostRender=new W_,this.render_descriptor_buffer=R0.createBuffer({label:"View::RenderDescriptorBuffer",size:this.render_descriptor.uniform_view.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});var G=0,$,T;let L=this,I=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{}}]}),z=R0.createSampler({magFilter:"linear",minFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"});var l;let x=R0.createRenderPipeline({layout:R0.createPipelineLayout({bindGroupLayouts:[I]}),label:"CRT::Pipeline",vertex:{module:R0.createShaderModule({label:"CRT::VertexShader",code:w_})},fragment:{module:R0.createShaderModule({label:"CRT::FragmentShader",code:w_}),targets:[{format:this.format,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one"}}}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"}});function b(r){let J0=(r-G)/1000;if(G=r,L.PreRender.Emit(J0),L.Camera.ViewportSize.x=_.width,L.Camera.ViewportSize.y=_.height,!$||$.width!=L.Camera.ViewportSize.x||$.height!=L.Camera.ViewportSize.y)$=R0.createTexture({label:"View::DepthTexture",size:[L.Camera.ViewportSize.x,L.Camera.ViewportSize.y],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),T=R0.createTexture({size:[_.width,_.height],format:L.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),l=R0.createBindGroup({label:"CRT::BindGroup",layout:I,entries:[{binding:0,resource:T.createView()},{binding:1,resource:z},{binding:2,resource:{buffer:L.render_descriptor_buffer}}]});let U0=R0.createCommandEncoder(),s=U0.beginRenderPass({label:"View::RenderPass",colorAttachments:[{view:T.createView(),loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:$.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});L.render_descriptor.time=r/1000,L.render_descriptor.delta_time=J0,L.render_descriptor.update(),L.device.queue.writeBuffer(L.render_descriptor_buffer,0,L.render_descriptor.uniform_view.arrayBuffer);for(let[I0,_0]of L.render_info.entries()){if(s.setPipeline(_0.pipeline),s.setBindGroup(0,_0.bind_group),_0.extra_bind_group)s.setBindGroup(1,_0.extra_bind_group);s.draw(_0.vertex_count,_0.objs.size),s.end(),R0.queue.submit([U0.finish()])}let X0=R0.createCommandEncoder(),Z0=X0.beginRenderPass({colorAttachments:[{view:J.getCurrentTexture().createView(),loadOp:"clear",storeOp:"store"}]});Z0.setPipeline(x),Z0.setBindGroup(0,l),Z0.draw(4),Z0.end(),R0.queue.submit([X0.finish()]),L.PostRender.Emit(L.render_descriptor),requestAnimationFrame(b)}requestAnimationFrame(b)}_getRenderObjectData(_,J){let G={};for(let $ in J.buf.views[0]){let T=AU($),L=_[T];if(!Object.hasOwn(_,T))throw new Error(`property '${$}' defined in the shader doesn't exist on '${_.ClassName}' as '${T}'`);if(typeof L=="object"&&typeof L.serialize=="function"){let I=L.serialize(this.render_descriptor);if(I)G[$]=I}else if(typeof L=="number")G[$]=L;else if(typeof L=="boolean")G[$]=L?1:0;else throw new Error(`serialization failed: unsupported property '${T}' data type '${typeof L}'`)}return G}_updateRenderObject(_){let J=this.render_info.get(_.ClassName);if(!J)throw new Error(`'${_.ClassName}' objects haven't been added yet. call '_addRenderObject' before updating this object.`);if(!J.objs.get(_))throw new Error("this object has not been added yet, so it can't be updated. call '_addRenderObject' on it.");J.objs.set(_,this._getRenderObjectData(_,J)),J.buf.set([...J.objs.values()]),this.device.queue.writeBuffer(J.prop_buf,0,J.buf.arrayBuffer)}_removeRenderObject(_){let J=this.render_info.get(_.ClassName);if(!J)throw new Error(`'${_.ClassName}' objects haven't been added yet. call '_addRenderObject' before updating this object.`);if(!J.objs.has(_))throw new Error("this object doesn't exist, so it can't be removed.");if(J.objs.delete(_),J.objs.size===0)this.render_info.delete(_.ClassName);else J.buf.set([...J.objs.values()]),this.device.queue.writeBuffer(J.prop_buf,0,J.buf.arrayBuffer)}_addRenderObject(_){let J=this.render_info.get(_.obj.ClassName),G=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]});if(!J){let T=hJ(_.vert_shader).storages.props,{size:L}=rJ(T);var $;if(_.entry_layouts)$=this.device.createBindGroupLayout({entries:_.entry_layouts||[]});J={def:T,objs:new Map,obj_size:L,vertex_count:_.vertex_count,pipeline:_.obj.createPipeline(this.device,$?[G,$]:[G],_.vert_shader,_.frag_shader),extra_bind_group:_.entries&&$?this.device.createBindGroup({label:`RenderObject.${_.obj.ClassName}::ExtraBindGroup`,layout:$,entries:_.entries}):void 0}}J.buf=YJ(J.def,new ArrayBuffer(J.obj_size*(J.objs.size+1))),J.objs.set(_.obj,this._getRenderObjectData(_.obj,J)),J.buf.set([...J.objs.values()]),J.prop_buf=this.device.createBuffer({label:`RenderObject.${_.obj.ClassName}::PropertyBuffer`,size:J.buf.arrayBuffer.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(J.prop_buf,0,J.buf.arrayBuffer),J.bind_group=this.device.createBindGroup({label:`RenderObject.${_.obj.ClassName}::BindGroup`,layout:G,entries:[{binding:0,resource:{buffer:this.render_descriptor_buffer}},{binding:1,resource:{buffer:J.prop_buf}}]}),this.render_info.set(_.obj.ClassName,J)}async createFont(_,J){let G=await fetch(_),$=await createImageBitmap(await G.blob()),[T,L]=[$.width,$.height],I=this.device.createTexture({size:[T,L,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.device.queue.copyExternalImageToTexture({source:$},{texture:I},[$.width,$.height]);let l=await(await fetch(J)).json(),x=new Map;if(l.kernings)for(let b of l.kernings){let r=x.get(b.first);if(!r)r=new Map,x.set(b.first,r);r.set(b.second,b.amount)}return{data:l,texture:I,kernings:x}}destroy(){}}var zU=Symbol();function b_(_,J,G){let $=_[zU];if(!$)$=new Map,_[zU]=$;for(let[T,L]of Object.entries(_)){if(!J.test(T)||$.has(T))continue;$.set(T,L),Object.defineProperty(_,T,{set(I){let z=$.get(T);$.set(T,I),G(T,z,I)},get(){return $.get(T)}})}}class X_{view;Children;Parent;ClassName;AnchorPoint;Size;Position;ZIndex;Fixed;Visible;constructor(_,J){this.ClassName=J,this.AnchorPoint=new i0(0,0),this.Size=new e0,this.Position=new e0,this.ZIndex=-1,this.Fixed=!1,this.Visible=!1,this.Children=new Set,this.view=_,b_(this,new RegExp(/^Parent$/),(G,$,T)=>{if($ instanceof X_)$.Children.delete(this);if(T instanceof X_)T.Children.add(this),T._update();else throw new Error("the parent of a render object can only be another render object.")})}createPipeline(_,J,G,$){return _.createRenderPipeline({layout:_.createPipelineLayout({bindGroupLayouts:J}),label:`RenderObject.${this.ClassName}::Pipeline`,vertex:{module:_.createShaderModule({label:`RenderObject.${this.ClassName}::VertexShader`,code:G})},fragment:{module:_.createShaderModule({label:`RenderObject.${this.ClassName}::FragmentShader`,code:$}),targets:[{format:this.view.format,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one"}}}]},primitive:{topology:"triangle-strip",stripIndexFormat:"uint32"},depthStencil:{format:"depth24plus",depthCompare:"less",depthWriteEnabled:!1}})}_update(){this.view._updateRenderObject(this);for(let _ of this.Children.values())_._update()}destroy(){this.view._removeRenderObject(this)}}var LJ=`const pos = array(vec2f(-1, -1), vec2f(1, -1), vec2f(-1, 1), vec2f(1, 1));

struct VertexInput {
  @builtin(vertex_index) vertex: u32,
  @builtin(instance_index) instance: u32,
};

struct VertexOutput {
  @builtin(position) position: vec4f,
  @location(0) @interpolate(flat) instance: u32,
};

struct RenderDescriptor {
  time: f32,
  delta_time: f32,

  view: mat4x4f,
  static_view: mat4x4f,

  scale: f32,
}

struct Properties {
  background_color: vec4f,

  anchor_point: vec2f,

  size: vec2f,
  position: vec2f,

  z_index: vec2f,

  fixed: f32,
  visible: f32,
}

@group(0) @binding(0) var<uniform> desc: RenderDescriptor;
@group(0) @binding(1) var<storage> props: array<Properties>;

@vertex
fn vertex_main(input: VertexInput) -> VertexOutput {
  var output: VertexOutput;

  let prop = props[input.instance];

  let anchor_offset = (prop.anchor_point * 2.0 - vec2f(1.0, 1.0));
  let local_pos = (pos[input.vertex] - anchor_offset) * prop.size / 2;
  let pixel_pos = local_pos + prop.position;

  if prop.fixed == 1 {
    output.position = desc.static_view * vec4f(pixel_pos, 0, 1);
  } else {
    output.position = desc.view * vec4f(pixel_pos, 0, 1);
  }

  output.instance = input.instance;

  return output;
}

@fragment
fn frag_main(input: VertexOutput) -> @location(0) vec4f {
  let prop = props[input.instance];

  return prop.background_color;
}
`;class kJ{r;g;b;a;constructor(_=0,J=0,G=0,$=1){this.r=_,this.g=J,this.b=G,this.a=$}serialize(){return[this.r,this.g,this.b,this.a]}}var BK=(_)=>/^#([A-Fa-f0-9]{3,4}){1,2}$/.test(_),WK=(_,J)=>_.match(new RegExp(`.{${J}}`,"g")),MK=(_)=>parseInt(_.repeat(2/_.length),16),VK=(_,J)=>{if(typeof _!=="undefined")return _/255;if(typeof J!="number"||J<0||J>1)return 1;return J},EJ={fromHex:(_,J=1)=>{if(!BK(_))throw new Error("invalid hex: "+_);let G=Math.floor((_.length-1)/3),$=WK(_.slice(1),G);if(!$)throw new Error("invalid hex: "+_);let[T,L,I,z]=$.map(MK);return new kJ(T/255,L/255,I/255,VK(z,J))},fromRGBA:(_,J,G,$=1)=>{return new kJ(_/255,J/255,G/255,$)}},lU=EJ;class h_ extends X_{BackgroundColor;constructor(_){super(_,"Frame");this.BackgroundColor=EJ.fromHex("#fff"),_._addRenderObject({obj:this,vert_shader:LJ,frag_shader:LJ,vertex_count:4}),b_(this,new RegExp(/^[A-z]/),()=>{this._update()})}}class v_{acceleration;initial_velocity;initial_position;last_timestamp;constructor(){this.acceleration=100,this.initial_velocity=0,this.initial_position=0,this.last_timestamp=0}jump(_){this.initial_position=this.getposition(_),this.initial_velocity=-150,this.last_timestamp=_}reset(){this.initial_velocity=0,this.initial_position=0,this.last_timestamp=0}getposition(_){let J=_-this.last_timestamp;return this.initial_position+this.initial_velocity*J+0.5*this.acceleration*J**2}}var r_=document.querySelector("canvas");if(!r_)throw new Error("no canvas found in the page");var $_=new p_(r_),L_=800,i_=800,P_=50;r_.width=L_;r_.height=i_;$_.Camera.Resolution=new i0(L_,i_);var B_=new h_($_);B_.Fixed=!0;B_.Size=z_.fromAbs(P_,P_);B_.AnchorPoint=new i0(0.5,0.5);B_.Position=z_.fromRel(0.5,0.5);var N_=new Set,RJ=0.3,k_=100,d_,qJ,SJ,PJ=P_/i_;function HK(_,J){return _+(J-_)*Math.random()}function CU(_,J){let G=new h_($_);G.AnchorPoint=new i0(0,_),G.BackgroundColor=lU.fromHex("#36e379"),G.Size=z_.fromAbs(k_,i_*(J-RJ/2)),G.Position=new e0(1,-$_.Camera.Position.x+k_*2,_,0),N_.add(G),d_=G}var Z_=-1,uU=document.getElementById("score"),cU=document.getElementById("hiscore");cU.innerText=`HI: ${localStorage.getItem("hiscore")||0}`;var o_=()=>{let _=HK(0.2,0.8);qJ=_,CU(0,_),CU(1,1-_),Z_+=1,uU.innerText=`SCORE: ${Z_}`};o_();SJ=setInterval(o_,3000);var Y_=0,jK=0,E_=new v_;$_.PreRender.Connect((_)=>{N_.forEach((G)=>{let $=300*_;if(G.Position.abs_x-=$,jK+=$,G.Position.abs_x+k_<-L_){G.destroy(),N_.delete(G);return}G._update()});let J=0.5+E_.getposition(Y_)/$_.Camera.ViewportSize.y;if(d_){if(J+PJ/2>=1||d_.Position.abs_x>=-L_/2-k_/2-P_&&d_.Position.abs_x<=-L_/2+k_/2-P_/2&&(J>qJ+RJ/2-PJ/2||J<qJ-RJ/2+PJ/2)){if(E_.reset(),Z_>localStorage.getItem("hiscore"))localStorage.setItem("hiscore",Z_.toString()),cU.innerText=`HI: ${Z_}`;Z_=-1,Y_=0,uU.innerText="SCORE: 0",N_.forEach((G)=>G.destroy()),N_.clear(),clearTimeout(SJ),SJ=setInterval(o_,3000),o_()}}B_.Position.abs_y=E_.getposition(Y_),B_._update(),Y_+=_*4});document.addEventListener("keydown",(_)=>{if(_.key!=" ")return;E_.jump(Y_)});document.addEventListener("mousedown",(_)=>{E_.jump(Y_)});
